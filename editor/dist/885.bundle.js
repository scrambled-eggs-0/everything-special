"use strict";(self.webpackChunkOmniblockly=self.webpackChunkOmniblockly||[]).push([[885],{885:(e,t,o)=>{o.r(t),o.d(t,{default:()=>M});var l=o(937);const{until:n}=l.default;let i,a,r=0,c=0,s=!1,d=60,g=850,w=1550,m=!1,h=!1,p=0,u=0,x=0,f=new Image;f.src="./gfx/yellowgear.png";let v=new Image;v.src="./gfx/locked.png";let b=new Image;b.src="./gfx/unlocked.png";let S=new Image;S.src="./gfx/thumbsup.png";let k=new Image,I=new Image,F=new Image;F.src="./gfx/pencil.png";let y=new Image;y.src="./gfx/paintbrush.png";let L=new Image;L.src="./gfx/standalone.png";let $=new Image;$.src="./gfx/creator.png";let C=new Image;function A(e,t="black"){if(!1===e.complete)return void setTimeout((()=>{A(e,t)}),200);const o=document.createElement("canvas"),l=o.getContext("2d");o.width=e.width,o.height=e.height,l.drawImage(e,0,0),l.globalCompositeOperation="source-atop",l.fillStyle=t,l.fillRect(0,0,o.width,o.height);let n=new Image;return n.src=o.toDataURL(),n.generatedCol=t,n}C.src="./gfx/close.png",C.onload=()=>{C=A(C,"blue")},v.onload=()=>{v=A(v,"red")},b.onload=()=>{b=A(b,"blue")},F.onload=()=>{F=A(F,"red")},y.onload=()=>{y=A(y,"green")},S.onload=()=>{k=A(S,"green"),I=A(S,"red")},f.onload=()=>{s=!0};let E=!1,N=!1,T=0,O="",P=localStorage.getItem("username"),R=localStorage.getItem("hashedPassword"),D={},U={};requestIdleCallback((()=>{const e=(localStorage.getItem("likedLevels")??"").split("|"),t=(localStorage.getItem("dislikedLevels")??"").split("|");for(let t=0;t<e.length;t++)D[e[t]]=!0;for(let e=0;e<t.length;e++)U[t[e]]=!0}));const X=[{x:100,y:100,img:()=>!0===window.scrollLocked?v:b,hoverFn:()=>{window.scrollLocked=!window.scrollLocked},text:"Lock/Unlock Scroll",fontSize:38},{x:550,y:100,imgScale:.92,img:()=>$,hoverFn:()=>{fetch(`${location.origin}/getUser/${window.levelFileName}`,{method:"GET"}).then((async e=>{const t=await e.text();location.replace(`${location.origin}/profile/${t}`)})).catch((e=>{console.error("err: ",e)}))},text:"View Creator"},{x:100,y:465,imgScale:1.2,img:()=>k,hoverFn:async()=>{await Y();const e=new Headers;e.append("u",P),e.append("hp",R),fetch(`${location.origin}/like/${window.levelFileName}`,{method:"POST",headers:e}).then((e=>{E=!E;const t=window.levelFileName.slice(0,window.levelFileName.length-3);console.log({lfn:window.levelFileName,withoutTheJs:t}),!0===E?D[t]=!0:delete D[t],localStorage.setItem("likedLevels",Object.keys(D).join("|"))})).catch((e=>{console.error("err: ",e)}))},imgAlphaFn:()=>!0===E?.67:1,textFn:()=>!0===E?"Unlike":"Like"},{x:550,y:465,imgScale:1.2,img:()=>I,hoverFn:async()=>{await Y();const e=new Headers;e.append("u",P),e.append("hp",R),fetch(`${location.origin}/dislike/${window.levelFileName}`,{method:"POST",headers:e}).then((e=>{N=!N;const t=window.levelFileName.slice(0,window.levelFileName.length-3);!0===N?U[t]=!0:delete U[t],localStorage.setItem("dislikedLevels",Object.keys(U).join("|"))})).catch((e=>{console.error("err: ",e)}))},imgAlphaFn:()=>!0===N?.67:1,textFn:()=>!0===N?"Un-dislike":"Dislike",label:"Dislike"},{x:100,y:830,img:()=>F,text:"Editor",label:"Editor",imgScale:1.18,hoverFn:()=>{location.replace(location.origin+"/editor")}},{x:550,y:830,img:()=>y,imgScale:.9,text:"Remix",label:"Remix",hoverFn:()=>{fetch(`${location.origin}/remix/${window.levelFileName}`,{method:"GET"}).then((async e=>{const t=await e.text();localStorage.setItem("ws",t),location.replace(location.origin+"/editor")})).catch((e=>{console.error("err: ",e)}))}},{x:100,y:1195,img:()=>L,text:"Share This Level",fontSize:38,hoverFn:()=>{navigator.clipboard.writeText(`${location.origin}/standalone/${window.levelFileName.split(".")[0]}`),T=1,O="Link Copied to Clipboard!"}},{x:550,y:1195,img:()=>C,hoverFn:()=>{!0===h&&(H(),G=!1)},text:"Close"}];async function Y(){if(null!==P)return!0;const e=`${location.origin}/account`;let t=!1;const o=document.createElement("iframe");o.src=e,o.classList.add("loginWindow");const l=function(e){e.origin===location.origin&&(o.remove(),window.removeEventListener("message",l),t=!0)};return window.addEventListener("message",l),document.body.appendChild(o),await n((()=>t)),P=localStorage.getItem("username"),R=localStorage.getItem("hashedPassword"),!0}function M(e,t,o=!1){var l,n,v,b;if((window.mouseX-g)**2+(window.mouseY-w)**2<d**2/4?(r+=.012,m=!0):m=!1,.1,c=(l=c)+.1*(2*(v=(r-l)%(n=2*Math.PI))%n-v),!0===s&&(t.globalAlpha=.3,t.translate(g,w),0!==c&&t.rotate(c),t.drawImage(f,-d/2,-d/2,d,d),0!==c&&t.rotate(-c),t.translate(-g,-w),t.globalAlpha=1),!0===h&&1!==p?(p+=.03,p>1&&(p=1)):!1===h&&0!==p&&(p-=.03,p<0&&(p=0)),0!==p){t.textAlign="center",t.textBaseline="middle";const o=(1-((b=p)*b*(1-b)+(1-(1-b)*(1-b))*b))*e.width;t.translate(o,0),t.fillStyle=i,t.fillRect(0,0,e.width,e.height),a=void 0;for(let e=0;e<X.length;e++){const l=X[e];void 0!==l.imgAlphaFn&&(t.globalAlpha=l.imgAlphaFn()),void 0!==l.imgScale?(t.translate(l.x+125,l.y+125),t.scale(l.imgScale,l.imgScale),void 0!==l.textFn&&(l.text=l.textFn()),"Dislike"===l.label?t.rotate(Math.PI):"Editor"===l.label?t.rotate(u+=.023):"Remix"===l.label&&t.rotate(x-=.024),t.drawImage(l.img(),-125,-125,250,250),"Dislike"===l.label?t.rotate(-Math.PI):"Editor"===l.label?t.rotate(-u):"Remix"===l.label&&t.rotate(-x),t.scale(1/l.imgScale,1/l.imgScale),t.translate(-l.x-125,-l.y-125)):t.drawImage(l.img(),l.x,l.y,250,250),t.globalAlpha=1,t.font=`${l.fontSize??56}px Inter`,t.fillStyle="white",t.fillText(l.text,l.x+125,l.y+283),window.mouseX>l.x+o&&window.mouseX<l.x+o+250&&window.mouseY>l.y&&window.mouseY<l.y+250&&(a=l.hoverFn)}t.translate(-o,0)}T>0&&(t.font="56px Inter",t.globalAlpha=T,T-=.012,t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.fillText(O,450,930),t.globalAlpha=1)}let j,z,G=!1,B=!1;function H(){h=!h,void 0===i&&(i=window.ctx.createLinearGradient(0,0,1600,0),i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(1,"rgba(0, 0, 0, 0.6)"))}j=z=0,window.addSideMenuEvtListeners=e=>{window.mouseDownFunctions.push((()=>{!0===m?(G=!0,dragging=!1,j=window.mouseX,z=window.mouseY):(G=!1,void 0!==a&&(a(),dragging=!1))})),window.mouseMoveFunctions.push((()=>{!0===G&&(!0===B||(j-window.mouseX)**2+(z-window.mouseY)**2>1600)&&(B=!0,g=window.mouseX,w=window.mouseY)})),window.mouseUpFunctions.push((()=>{!0===G&&!0===m&&!1===B&&H(),!0===B&&g>800-d/2&&w>1500-d/2&&(g=850,w=1550),G=!1,B=!1}));const t=e.slice(0,e.length-3);E=!0===D[t],N=!0===U[t]}}}]);