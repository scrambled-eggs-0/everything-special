"use strict";(self.webpackChunkOmniblockly=self.webpackChunkOmniblockly||[]).push([[885],{885:(e,t,o)=>{o.r(t),o.d(t,{default:()=>j});var l=o(937);const{until:n}=l.default;let i,a,r=0,c=0,s=!1,d=60,g=850,m=1550,w=!1,h=!1,p=0,u=0,x=0,f=new Image;f.src="./gfx/yellowgear.png";let v=new Image;v.src="./gfx/locked.png";let S=new Image;S.src="./gfx/unlocked.png";let b=new Image;b.src="./gfx/thumbsup.png";let k=new Image,I=new Image,F=new Image;F.src="./gfx/pencil.png";let y=new Image;y.src="./gfx/paintbrush.png";let L=new Image;L.src="./gfx/standalone.png";let $=new Image;$.src="./gfx/creator.png";let C=new Image;function A(e,t="black"){if(!1===e.complete)return void setTimeout((()=>{A(e,t)}),200);const o=document.createElement("canvas"),l=o.getContext("2d");o.width=e.width,o.height=e.height,l.drawImage(e,0,0),l.globalCompositeOperation="source-atop",l.fillStyle=t,l.fillRect(0,0,o.width,o.height);let n=new Image;return n.src=o.toDataURL(),n.generatedCol=t,n}C.src="./gfx/close.png",C.onload=()=>{C=A(C,"blue")},v.onload=()=>{v=A(v,"red")},S.onload=()=>{S=A(S,"blue")},F.onload=()=>{F=A(F,"red")},y.onload=()=>{y=A(y,"green")},b.onload=()=>{k=A(b,"green"),I=A(b,"red")},f.onload=()=>{s=!0};let T=!1,E=!1,N=0,O="",P=localStorage.getItem("username"),R=localStorage.getItem("hashedPassword"),D={},U={},X=!0;requestIdleCallback((()=>{const e=(localStorage.getItem("likedLevels")??"").split("|"),t=(localStorage.getItem("dislikedLevels")??"").split("|");for(let t=0;t<e.length;t++)D[e[t]]=!0;for(let e=0;e<t.length;e++)U[t[e]]=!0}));const Y=[{x:100,y:100,img:()=>!0===window.scrollLocked?v:S,hoverFn:()=>{window.scrollLocked=!window.scrollLocked},text:"Lock/Unlock Scroll",fontSize:38},{x:550,y:100,imgScale:.92,img:()=>$,hoverFn:()=>{fetch(`${location.origin}/getUser/${window.levelFileName}`,{method:"GET"}).then((async e=>{const t=await e.text();location.replace(`${location.origin}/profile/${t}`)})).catch((e=>{console.error("err: ",e)}))},text:"View Creator"},{x:100,y:465,imgScale:1.2,img:()=>k,hoverFn:async()=>{await M();const e=new Headers;e.append("u",P),e.append("hp",R),fetch(`${location.origin}/like/${window.levelFileName}`,{method:"POST",headers:e}).then((e=>{T=!T;const t=window.levelFileName.slice(0,window.levelFileName.length-3);console.log({lfn:window.levelFileName,withoutTheJs:t}),!0===T?D[t]=!0:delete D[t],localStorage.setItem("likedLevels",Object.keys(D).join("|"))})).catch((e=>{console.error("err: ",e)}))},imgAlphaFn:()=>!0===T?.67:1,textFn:()=>!0===T?"Unlike":"Like"},{x:550,y:465,imgScale:1.2,img:()=>I,hoverFn:async()=>{await M();const e=new Headers;e.append("u",P),e.append("hp",R),fetch(`${location.origin}/dislike/${window.levelFileName}`,{method:"POST",headers:e}).then((e=>{E=!E;const t=window.levelFileName.slice(0,window.levelFileName.length-3);!0===E?U[t]=!0:delete U[t],localStorage.setItem("dislikedLevels",Object.keys(U).join("|"))})).catch((e=>{console.error("err: ",e)}))},imgAlphaFn:()=>!0===E?.67:1,textFn:()=>!0===E?"Un-dislike":"Dislike",label:"Dislike"},{x:100,y:830,img:()=>F,text:"Editor",label:"Editor",imgScale:1.18,hoverFn:()=>{location.replace(location.origin+"/editor")}},{x:550,y:830,img:()=>y,imgScale:.9,text:"Remix",label:"Remix",hoverFn:()=>{fetch(`${location.origin}/remix/${window.levelFileName}`,{method:"GET"}).then((async e=>{const t=await e.text();localStorage.setItem("ws",t),location.replace(location.origin+"/editor")})).catch((e=>{console.error("err: ",e)}))}},{x:100,y:1195,img:()=>L,text:"Share This Level",fontSize:38,hoverFn:()=>{navigator.clipboard.writeText(`${location.origin}/standalone/${window.levelFileName.split(".")[0]}`),N=1,O="Link Copied to Clipboard!",!0===X&&(X=!1,setTimeout((()=>{X=!0}),5e3),fetch(`${location.origin}/share`,{method:"POST"}))}},{x:550,y:1195,img:()=>C,hoverFn:()=>{!0===h&&(q(),B=!1)},text:"Close"}];async function M(){if(null!==P)return!0;const e=`${location.origin}/account`;let t=!1;const o=document.createElement("iframe");o.src=e,o.classList.add("loginWindow");const l=function(e){e.origin===location.origin&&(o.remove(),window.removeEventListener("message",l),t=!0)};return window.addEventListener("message",l),document.body.appendChild(o),await n((()=>t)),P=localStorage.getItem("username"),R=localStorage.getItem("hashedPassword"),!0}function j(e,t,o=!1){var l,n,v,S;if((window.mouseX-g)**2+(window.mouseY-m)**2<d**2/4?(r+=.012,w=!0):w=!1,.1,c=(l=c)+.1*(2*(v=(r-l)%(n=2*Math.PI))%n-v),!0===s&&(t.globalAlpha=.3,t.translate(g,m),0!==c&&t.rotate(c),t.drawImage(f,-d/2,-d/2,d,d),0!==c&&t.rotate(-c),t.translate(-g,-m),t.globalAlpha=1),!0===h&&1!==p?(p+=.03,p>1&&(p=1)):!1===h&&0!==p&&(p-=.03,p<0&&(p=0)),0!==p){t.textAlign="center",t.textBaseline="middle";const o=(1-((S=p)*S*(1-S)+(1-(1-S)*(1-S))*S))*e.width;t.translate(o,0),t.fillStyle=i,t.fillRect(0,0,e.width,e.height),a=void 0;for(let e=0;e<Y.length;e++){const l=Y[e];void 0!==l.imgAlphaFn&&(t.globalAlpha=l.imgAlphaFn()),void 0!==l.imgScale?(t.translate(l.x+125,l.y+125),t.scale(l.imgScale,l.imgScale),void 0!==l.textFn&&(l.text=l.textFn()),"Dislike"===l.label?t.rotate(Math.PI):"Editor"===l.label?t.rotate(u+=.023):"Remix"===l.label&&t.rotate(x-=.024),t.drawImage(l.img(),-125,-125,250,250),"Dislike"===l.label?t.rotate(-Math.PI):"Editor"===l.label?t.rotate(-u):"Remix"===l.label&&t.rotate(-x),t.scale(1/l.imgScale,1/l.imgScale),t.translate(-l.x-125,-l.y-125)):t.drawImage(l.img(),l.x,l.y,250,250),t.globalAlpha=1,t.font=`${l.fontSize??56}px Inter`,t.fillStyle="white",t.fillText(l.text,l.x+125,l.y+283),window.mouseX>l.x+o&&window.mouseX<l.x+o+250&&window.mouseY>l.y&&window.mouseY<l.y+250&&(a=l.hoverFn)}t.translate(-o,0)}N>0&&(t.font="56px Inter",t.globalAlpha=N,N-=.012,t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.fillText(O,450,930),t.globalAlpha=1)}let z,G,B=!1,H=!1;function q(){h=!h,void 0===i&&(i=window.ctx.createLinearGradient(0,0,1600,0),i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(1,"rgba(0, 0, 0, 0.6)"))}z=G=0,window.addSideMenuEvtListeners=e=>{window.mouseDownFunctions.push((()=>{!0===w?(B=!0,dragging=!1,z=window.mouseX,G=window.mouseY):(B=!1,void 0!==a&&(a(),dragging=!1))})),window.mouseMoveFunctions.push((()=>{!0===B&&(!0===H||(z-window.mouseX)**2+(G-window.mouseY)**2>1600)&&(H=!0,g=window.mouseX,m=window.mouseY)})),window.mouseUpFunctions.push((()=>{!0===B&&!0===w&&!1===H&&q(),!0===H&&g>800-d/2&&m>1500-d/2&&(g=850,m=1550),B=!1,H=!1}));const t=e.slice(0,e.length-3);T=!0===D[t],E=!0===U[t]}}}]);