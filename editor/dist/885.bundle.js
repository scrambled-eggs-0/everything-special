"use strict";(self.webpackChunkOmniblockly=self.webpackChunkOmniblockly||[]).push([[885],{885:(e,o,t)=>{t.r(o),t.d(o,{default:()=>j});var l=t(937);const{until:n}=l.default;let i,a,r=0,c=0,s=!1,d=60,w=850,g=1550,m=!1,h=!1,u=0,p=0,x=0,f=new Image;f.src="./gfx/yellowgear.png";let v=new Image;v.src="./gfx/locked.png";let S=new Image;S.src="./gfx/unlocked.png";let b=new Image;b.src="./gfx/thumbsup.png";let k=new Image,F=new Image,y=new Image;y.src="./gfx/pencil.png";let I=new Image;I.src="./gfx/paintbrush.png";let L=new Image;L.src="./gfx/standalone.png";let $=new Image;$.src="./gfx/creator.png";let C=new Image;function A(e,o="black"){if(!1===e.complete)return void setTimeout((()=>{A(e,o)}),200);const t=document.createElement("canvas"),l=t.getContext("2d");t.width=e.width,t.height=e.height,l.drawImage(e,0,0),l.globalCompositeOperation="source-atop",l.fillStyle=o,l.fillRect(0,0,t.width,t.height);let n=new Image;return n.src=t.toDataURL(),n.generatedCol=o,n}C.src="./gfx/close.png",C.onload=()=>{C=A(C,"blue")},v.onload=()=>{v=A(v,"red")},S.onload=()=>{S=A(S,"blue")},y.onload=()=>{y=A(y,"red")},I.onload=()=>{I=A(I,"green")},b.onload=()=>{k=A(b,"green"),F=A(b,"red")},f.onload=()=>{s=!0};let T=!1,E=!1,N=0,X="",Y=localStorage.getItem("username"),O=localStorage.getItem("hashedPassword"),P={},R={},D=!0;requestIdleCallback((()=>{const e=(localStorage.getItem("likedLevels")??"").split("|"),o=(localStorage.getItem("dislikedLevels")??"").split("|");for(let o=0;o<e.length;o++)P[e[o]]=!0;for(let e=0;e<o.length;e++)R[o[e]]=!0}));const U=[{x:100,y:100,img:()=>!0===window.scrollLocked?v:S,hoverFn:()=>{window.scrollLocked=!window.scrollLocked},textFn:()=>!0===window.scrollLocked?"Unlock Scroll":"Lock Scroll",imgScale:1,label:"scrollLock"},{x:550,y:100,imgScale:.92,img:()=>$,hoverFn:()=>{fetch(`${location.origin}/getUser/${window.levelFileName}`,{method:"GET"}).then((async e=>{const o=await e.text();location.replace(`${location.origin}/profile/${o}`)})).catch((e=>{console.error("err: ",e)}))},text:"View Creator"},{x:100,y:465,imgScale:1.2,img:()=>k,hoverFn:async()=>{await M();const e=new Headers;e.append("u",Y),e.append("hp",O),fetch(`${location.origin}/like/${window.levelFileName}`,{method:"POST",headers:e}).then((e=>{T=!T;const o=window.levelFileName.slice(0,window.levelFileName.length-3);console.log({lfn:window.levelFileName,withoutTheJs:o}),!0===T?P[o]=!0:delete P[o],localStorage.setItem("likedLevels",Object.keys(P).join("|"))})).catch((e=>{console.error("err: ",e)}))},imgAlphaFn:()=>!0===T?.67:1,textFn:()=>!0===T?"Unlike":"Like"},{x:550,y:465,imgScale:1.2,img:()=>F,hoverFn:async()=>{await M();const e=new Headers;e.append("u",Y),e.append("hp",O),fetch(`${location.origin}/dislike/${window.levelFileName}`,{method:"POST",headers:e}).then((e=>{E=!E;const o=window.levelFileName.slice(0,window.levelFileName.length-3);!0===E?R[o]=!0:delete R[o],localStorage.setItem("dislikedLevels",Object.keys(R).join("|"))})).catch((e=>{console.error("err: ",e)}))},imgAlphaFn:()=>!0===E?.67:1,textFn:()=>!0===E?"Un-dislike":"Dislike",label:"Dislike"},{x:100,y:830,img:()=>y,text:"Editor",label:"Editor",imgScale:1.18,hoverFn:()=>{location.replace(location.origin+"/editor")}},{x:550,y:830,img:()=>I,imgScale:.9,text:"Remix",label:"Remix",hoverFn:()=>{fetch(`${location.origin}/remix/${window.levelFileName}`,{method:"GET"}).then((async e=>{const o=await e.text();localStorage.setItem("ws",o),location.replace(location.origin+"/editor")})).catch((e=>{console.error("err: ",e)}))}},{x:100,y:1195,img:()=>L,text:"Share This Level",fontSize:38,hoverFn:()=>{navigator.clipboard.writeText(`${location.origin}/standalone/${window.levelFileName.split(".")[0]}`),N=1,X="Link Copied to Clipboard!",!0===D&&(D=!1,setTimeout((()=>{D=!0}),5e3),fetch(`${location.origin}/share`,{method:"POST"}))}},{x:550,y:1195,img:()=>C,hoverFn:()=>{!0===h&&(J(),H=!1)},text:"Close"}];async function M(){if(null!==Y)return!0;const e=`${location.origin}/account`;let o=!1;const t=document.createElement("iframe");t.src=e,t.classList.add("loginWindow");const l=function(e){e.origin===location.origin&&(t.remove(),window.removeEventListener("message",l),o=!0)};return window.addEventListener("message",l),document.body.appendChild(t),await n((()=>o)),Y=localStorage.getItem("username"),O=localStorage.getItem("hashedPassword"),!0}function j(e,o,t=!1){var l,n,m;if((window.mouseX-w)**2+(window.mouseY-g)**2<d**2/4&&(r+=.012),.1,c=(l=c)+.1*(2*(m=(r-l)%(n=2*Math.PI))%n-m),!0===s&&(o.globalAlpha=.3,o.translate(w,g),0!==c&&o.rotate(c),o.drawImage(f,-d/2,-d/2,d,d),0!==c&&o.rotate(-c),o.translate(-w,-g),o.globalAlpha=1),!0===h&&1!==u?(u+=.03,u>1&&(u=1)):!1===h&&0!==u&&(u-=.03,u<0&&(u=0)),0!==u){o.textAlign="center",o.textBaseline="middle";const t=(1-z(u))*e.width;o.translate(t,0),o.fillStyle=i,o.fillRect(0,0,e.width,e.height),a=void 0;for(let e=0;e<U.length;e++){const l=U[e];void 0!==l.imgAlphaFn&&(o.globalAlpha=l.imgAlphaFn()),void 0!==l.imgScale?(o.translate(l.x+125,l.y+125),o.scale(l.imgScale,l.imgScale),void 0!==l.textFn&&(l.text=l.textFn()),"Dislike"===l.label?o.rotate(Math.PI):"Editor"===l.label?o.rotate(p+=.023):"Remix"===l.label&&o.rotate(x-=.024),o.drawImage(l.img(),-125,-125,250,250),"Dislike"===l.label?o.rotate(-Math.PI):"Editor"===l.label?o.rotate(-p):"Remix"===l.label&&o.rotate(-x),o.scale(1/l.imgScale,1/l.imgScale),o.translate(-l.x-125,-l.y-125)):o.drawImage(l.img(),l.x,l.y,250,250),o.globalAlpha=1,"scrollLock"===l.label&&(l.fontSize=!0===window.scrollLocked?44:52),o.font=`${l.fontSize??56}px Inter`,o.fillStyle="white",o.fillText(l.text,l.x+125,l.y+283),window.mouseX>l.x+t&&window.mouseX<l.x+t+250&&window.mouseY>l.y&&window.mouseY<l.y+250&&(a=l.hoverFn)}o.translate(-t,0)}N>0&&(o.font="56px Inter",o.globalAlpha=N,N-=.012,o.fillStyle="white",o.textAlign="center",o.textBaseline="middle",o.fillText(X,450,930),o.globalAlpha=1)}function z(e){return e*e*(1-e)+(1-(1-e)*(1-e))*e}let G,B,H=!1,q=!1;function J(){h=!h,void 0===i&&(i=window.ctx.createLinearGradient(0,0,1600,0),i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(1,"rgba(0, 0, 0, 0.6)"))}G=B=0,window.addSideMenuEvtListeners=e=>{window.mouseDownFunctions.push((()=>{m=!0===s&&(window.mouseX-w)**2+(window.mouseY-g)**2<d**2/4;const e=(1-z(u))*canvas.width;a=void 0;for(let o=0;o<U.length;o++){const t=U[o];window.mouseX>t.x+e&&window.mouseX<t.x+e+250&&window.mouseY>t.y&&window.mouseY<t.y+250&&(a=t.hoverFn)}!0===m?(H=!0,dragging=!1,G=window.mouseX,B=window.mouseY):(H=!1,void 0!==a&&(a(),dragging=!1))})),window.mouseMoveFunctions.push((()=>{!0===H&&(!0===q||(G-window.mouseX)**2+(B-window.mouseY)**2>1e4)&&(q=!0,w=window.mouseX,g=window.mouseY)})),window.mouseUpFunctions.push((()=>{m=(window.mouseX-w)**2+(window.mouseY-g)**2<d**2/4,!0===H&&!0===m&&!1===q&&J(),!0===q&&w>800-d/2&&g>1500-d/2&&(w=850,g=1550),H=!1,q=!1}));const o=e.slice(0,e.length-3);T=!0===P[o],E=!0===R[o]}}}]);