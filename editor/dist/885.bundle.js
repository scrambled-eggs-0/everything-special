"use strict";(self.webpackChunkOmniblockly=self.webpackChunkOmniblockly||[]).push([[885],{885:(e,t,l)=>{l.r(t),l.d(t,{default:()=>U});var o=l(937);const{until:n}=o.default;let i,a,r=0,s=0,d=!1,c=60,g=850,w=1550,m=!1,h=!1,u=0,p=new Image;p.src="./gfx/yellowgear.png";let f=new Image;f.src="./gfx/locked.png";let x=new Image;x.src="./gfx/unlocked.png";let v=new Image;v.src="./gfx/thumbsup.png";let k=new Image,S=new Image,I=new Image;I.src="./gfx/standalone.png";let F=new Image;F.src="./gfx/creator.png";let b=new Image;function y(e,t="black"){if(!1===e.complete)return void setTimeout((()=>{y(e,t)}),200);const l=document.createElement("canvas"),o=l.getContext("2d");l.width=e.width,l.height=e.height,o.drawImage(e,0,0),o.globalCompositeOperation="source-atop",o.fillStyle=t,o.fillRect(0,0,l.width,l.height);let n=new Image;return n.src=l.toDataURL(),n.generatedCol=t,n}b.src="./gfx/close.png",b.onload=()=>{b=y(b,"blue")},f.onload=()=>{f=y(f,"red")},x.onload=()=>{x=y(x,"blue")},v.onload=()=>{k=y(v,"green"),S=y(v,"red")},p.onload=()=>{d=!0};let L=!1,C=!1,A=0,$="",N=localStorage.getItem("username"),T=localStorage.getItem("hashedPassword"),O={},P={};requestIdleCallback((()=>{const e=(localStorage.getItem("likedLevels")??"").split("|"),t=(localStorage.getItem("dislikedLevels")??"").split("|");for(let t=0;t<e.length;t++)O[e[t]]=!0;for(let e=0;e<t.length;e++)P[t[e]]=!0}));const D=[{x:100,y:100,img:()=>!0===window.scrollLocked?f:x,hoverFn:()=>{window.scrollLocked=!window.scrollLocked},text:"Lock/Unlock Scroll",fontSize:38},{x:550,y:100,imgScale:.92,img:()=>F,hoverFn:()=>{fetch(`${location.origin}/getUser/${window.levelFileName}`,{method:"GET"}).then((async e=>{const t=await e.text();location.replace(`${location.origin}/profile/${t}`)})).catch((e=>{console.error("err: ",e)}))},text:"View Creator"},{x:100,y:550,imgScale:1.2,img:()=>k,hoverFn:async()=>{await E();const e=new Headers;e.append("u",N),e.append("hp",T),fetch(`${location.origin}/like/${window.levelFileName}`,{method:"POST",headers:e}).then((e=>{L=!L;const t=window.levelFileName.slice(0,window.levelFileName.length-3);console.log({lfn:window.levelFileName,withoutTheJs:t}),!0===L?O[t]=!0:delete O[t],localStorage.setItem("likedLevels",Object.keys(O).join("|"))})).catch((e=>{console.error("err: ",e)}))},imgAlphaFn:()=>!0===L?.67:1,textFn:()=>!0===L?"Unlike":"Like"},{x:550,y:550,imgScale:1.2,img:()=>S,hoverFn:async()=>{await E();const e=new Headers;e.append("u",N),e.append("hp",T),fetch(`${location.origin}/dislike/${window.levelFileName}`,{method:"POST",headers:e}).then((e=>{C=!C;const t=window.levelFileName.slice(0,window.levelFileName.length-3);!0===C?P[t]=!0:delete P[t],localStorage.setItem("dislikedLevels",Object.keys(P).join("|"))})).catch((e=>{console.error("err: ",e)}))},imgAlphaFn:()=>!0===C?.67:1,textFn:()=>!0===C?"Un-dislike":"Dislike",label:"Dislike"},{x:100,y:1e3,img:()=>I,text:"Share This Level",fontSize:38,hoverFn:()=>{navigator.clipboard.writeText(`${location.origin}/standalone/${window.levelFileName.split(".")[0]}`),A=1,$="Link Copied to Clipboard!"}},{x:550,y:1e3,img:()=>b,hoverFn:()=>{!0===h&&(z(),M=!1)},text:"Close"}];async function E(){if(null!==N)return!0;const e=`${location.origin}/account`;let t=!1;const l=document.createElement("iframe");l.src=e,l.classList.add("loginWindow");const o=function(e){e.origin===location.origin&&(l.remove(),window.removeEventListener("message",o),t=!0)};return window.addEventListener("message",o),document.body.appendChild(l),await n((()=>t)),N=localStorage.getItem("username"),T=localStorage.getItem("hashedPassword"),!0}function U(e,t,l=!1){var o,n,f,x;if((window.mouseX-g)**2+(window.mouseY-w)**2<c**2/4?(r+=.012,m=!0):m=!1,.1,s=(o=s)+.1*(2*(f=(r-o)%(n=2*Math.PI))%n-f),!0===d&&(t.globalAlpha=.3,t.translate(g,w),0!==s&&t.rotate(s),t.drawImage(p,-c/2,-c/2,c,c),0!==s&&t.rotate(-s),t.translate(-g,-w),t.globalAlpha=1),!0===h&&1!==u?(u+=.03,u>1&&(u=1)):!1===h&&0!==u&&(u-=.03,u<0&&(u=0)),0!==u){t.textAlign="center",t.textBaseline="middle";const l=(1-((x=u)*x*(1-x)+(1-(1-x)*(1-x))*x))*e.width;t.translate(l,0),t.fillStyle=i,t.fillRect(0,0,e.width,e.height),a=void 0;for(let e=0;e<D.length;e++){const o=D[e];void 0!==o.imgAlphaFn&&(t.globalAlpha=o.imgAlphaFn()),void 0!==o.imgScale?(t.translate(o.x+125,o.y+125),t.scale(o.imgScale,o.imgScale),void 0!==o.textFn&&(o.text=o.textFn()),"Dislike"===o.label&&t.rotate(Math.PI),t.drawImage(o.img(),-125,-125,250,250),"Dislike"===o.label&&t.rotate(-Math.PI),t.scale(1/o.imgScale,1/o.imgScale),t.translate(-o.x-125,-o.y-125)):t.drawImage(o.img(),o.x,o.y,250,250),t.globalAlpha=1,t.font=`${o.fontSize??56}px Inter`,t.fillStyle="white",t.fillText(o.text,o.x+125,o.y+283),window.mouseX>o.x+l&&window.mouseX<o.x+l+250&&window.mouseY>o.y&&window.mouseY<o.y+250&&(a=o.hoverFn)}t.translate(-l,0)}A>0&&(t.font="56px Inter",t.globalAlpha=A,A-=.012,t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.fillText($,450,930),t.globalAlpha=1)}let X,Y,M=!1,j=!1;function z(){h=!h,void 0===i&&(i=window.ctx.createLinearGradient(0,0,1600,0),i.addColorStop(0,"rgba(0, 0, 0, 0)"),i.addColorStop(1,"rgba(0, 0, 0, 0.6)"))}X=Y=0,window.addSideMenuEvtListeners=e=>{window.mouseDownFunctions.push((()=>{!0===m?(M=!0,dragging=!1,X=window.mouseX,Y=window.mouseY):(M=!1,void 0!==a&&(a(),dragging=!1))})),window.mouseMoveFunctions.push((()=>{!0===M&&(!0===j||(X-window.mouseX)**2+(Y-window.mouseY)**2>1600)&&(j=!0,g=window.mouseX,w=window.mouseY)})),window.mouseUpFunctions.push((()=>{!0===M&&!0===m&&!1===j&&z(),!0===j&&g>800-c/2&&w>1500-c/2&&(g=850,w=1550),M=!1,j=!1}));const t=e.slice(0,e.length-3);L=!0===O[t],C=!0===P[t]}}}]);