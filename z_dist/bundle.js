(()=>{var e,t,n,o,i={796:(e,t,n)=>{var o={"./arrow.png":[25,25],"./mouse.webp":[196,196]};function i(e){if(!n.o(o,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=o[e],i=t[0];return n.e(t[1]).then((()=>n.t(i,17)))}i.keys=()=>Object.keys(o),i.id=796,e.exports=i},674:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var o=n(601),i=n.n(o),r=n(314),a=n.n(r)()(i());a.push([e.id,"@import url(https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap);"]),a.push([e.id,"* {\n    box-sizing: border-box;\n    margin: 0;\n    padding: 0;\n}\n\nbody {\n    background-color: rgb(5,5,5);\n    font-size: 16px;\n    overflow: hidden;\n    font-family: 'Inter', sans-serif;\n}\n\n.hidden {\n    display: none !important;\n}\n\n/*for comparing to eX and gamefeel. Not permanent*/\ncanvas, .gui {\n    position: absolute;\n    left: 0;\n    top: 0;\n    /* filter: saturate(75%);  */\n}\n\n.text-layer {\n\tposition: absolute;\n\tleft: 0;\n\ttop: 0;\n\twidth: 1600px;\n\theight: 900px;\n\tfilter: none !important;\n\tbackground: transparent;\n\toverflow: hidden;\n}\n\n.chatDiv {\n    z-index: 100;\n}\n\n.chat {\n    position: absolute;\n    left: 0px;\n    top: 250px;\n    width: 374px;\n    height: 30px;\n    transform-origin: center center;\n    border: none;\n    outline: none;\n    color: white;\n    font-size: 1rem;\n    padding: 5px;\n    caret-color: white;\n    /*background: rgba(129, 129, 129, 0.082);*/\n    background: linear-gradient(to right, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0));\n    font-family: 'Inter-Thick', Inter;\n}\n\n.chat-message {\n    color: white;\n    font-size: 1.05rem;\n    background: transparent;\n    padding: 1px;\n\n    overflow-wrap: break-word;\n    width: 100%;\n}\n.system-message {\n    color: #c4c4c4;\n    font-size: 1rem;\n    background: transparent;\n    padding: 1px;\n    overflow-wrap: break-word; /*this doesnt work somehow*/\n    width: 100%;\n}\n\n.fade-out {\n    animation: fade-out 0.3s linear;\n}\n\n.fade-in {\n    animation: fade-in 0.3s linear;\n}\n\n@keyframes fade-out {\n    0% {\n        opacity: 1;\n    }\n    100% {\n        opacity: 0;\n    }\n}\n\n.peaceful {\n    color: #6cd95b;\n}\n.moderate {\n    color: #58ccb3;\n}\n.difficult {\n    color: #0a77bf;\n}\n.hardcore {\n    color: #3528e0;\n}\n.exhausting {\n    color: #8248d4;\n}\n.relentless {\n    color: #e32d8b;\n}\n@keyframes agonizingColor {\n    0% {\n        background-color: #ff0000;\n    }\n}\n.agonizing {\n    color: #ff5736;\n    animation-name: agonizingColor;\n    animation-duration: 3s;\n    animation-iteration-count: infinite;\n}\n@keyframes terrorizingColor {\n    0% {\n        background-color: #ff0000;\n    }\n}\n.terrorizing {\n    color: #fc3a3a;\n    animation-name: terrorizingColor;\n    animation-duration: 2s;\n    animation-iteration-count: infinite;\n}\n@keyframes cataclysmicColor {\n    0% {\n        background-color: #ff0000;\n    }\n}\n.cataclysmic {\n    color: #c95d5d;\n    animation-name: cataclysmicColor;\n    animation-duration: 1s;\n    animation-iteration-count: infinite;\n}\n\n.mention {\n    /*color: #a84040;*/\n    background-image: linear-gradient(\n        90deg,\n        rgba(255, 0, 0, 0.3),\n        rgba(255, 0, 0, 0)\n    );\n    animation-name: terrorizingColor;\n    animation-duration: 0.4s;\n    animation-iteration-count: 1;\n}\n\n.chat::placeholder {\n    color: white;\n    opacity: 1;\n}\n\n.leaderboard-div {\n    position: absolute;\n    left: calc(1600px - 299px);\n    transition: left 0.2s linear, opacity 0.2s linear;\n    opacity: 1;\n    top: -1px;\n    width: 300px;\n    height: 900px;\n    background: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.4));\n    display: flex;\n    justify-content: start;\n    align-items: center;\n    flex-direction: column;\n    padding: 0px;\n    color: white;\n    overflow-y: auto;\n    overflow-x: hidden;\n    user-select: none;\n    font-family: 'Inter-Thicke', Inter;\n}\n\n.hide {\n    left: 1600px !important;\n    opacity: 0;\n}\n\n.leaderboard-div::-webkit-scrollbar {\n    width: 10px;\n    background-color: rgba(255, 255, 255, 0.1);\n    border-radius: 2px;\n}\n\n.leaderboard-div::-webkit-scrollbar-thumb {\n    background-color: rgba(255, 255, 255, 0.3);\n    border-radius: 2px;\n}\n\n.rainbow {\n    animation: colorRotate 4s linear 0s infinite;\n}\n\n@keyframes colorRotate {\n    0% {\n        color: hsl(180, 100%, 50%);\n    }\n    50% {\n        color: hsl(216, 100%, 50%);\n    }\n    100% {\n        color: hsl(180, 100%, 50%);\n    }\n}\n\n.guest {\n    opacity: 0.8;\n}\n\n.chat-div::-webkit-scrollbar {\n    width: 10px;\n    background-color: rgba(0, 0, 0, 0.4);\n}\n\n.chat-div::-webkit-scrollbar-thumb {\n    background-color: rgba(0, 0, 0, 0.8);\n}\n\n.chat-div {\n    position: absolute;\n    left: -1px;\n    top: -1px;\n    width: 375px;\n    height: 251px;\n    filter: none !important;\n    background: rgba(141, 141, 141, 0.205);\n    background: linear-gradient(to right, rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0));\n    display: flex;\n    justify-content: flex-start;\n    align-items: flex-start;\n    flex-direction: column;\n    overflow-y: auto;\n    padding: 2px;\n    overflow-x: hidden;\n    /* \tword-break: break-all; */\n    font-family: Inter-Thick, Inter;\n    /*\n    /*background-image: url(https://i1.sndcdn.com/artworks-Uii8SMJvNPxy8ePA-romBoQ-t500x500.jpg);*/\n    /*    opacity: 0.7; */\n}",""]);const s=a},314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(o)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&a[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=r),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},601:e=>{"use strict";e.exports=function(e){return e[1]}},72:e=>{"use strict";var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var r={},a=[],s=0;s<e.length;s++){var l=e[s],c=o.base?l[0]+o.base:l[0],d=r[c]||0,p="".concat(c," ").concat(d);r[c]=d+1;var u=n(p),h={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==u)t[u].references++,t[u].updater(h);else{var w=i(h,o);o.byIndex=s,t.splice(s,0,{identifier:p,updater:w,references:1})}a.push(p)}return a}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var r=o(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<r.length;a++){var s=n(r[a]);t[s].references--}for(var l=o(e,i),c=0;c<r.length;c++){var d=n(r[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}r=l}}},659:e=>{"use strict";var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,i&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},681:()=>{shared.mapDifficulties=Object.freeze({popb:.1,poca:1.2,pospd:2.8,pos:4.1,pols:5.05,povv:.9,poqt:4.3,podc:6.4,posc:.2,poph:4.7})}},r={};function a(e){var t=r[e];if(void 0!==t)return t.exports;var n=r[e]={id:e,exports:{}};return i[e](n,n.exports,a),n.exports}a.m=i,a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,a.t=function(n,o){if(1&o&&(n=this(n)),8&o)return n;if("object"==typeof n&&n){if(4&o&&n.__esModule)return n;if(16&o&&"function"==typeof n.then)return n}var i=Object.create(null);a.r(i);var r={};e=e||[null,t({}),t([]),t(t)];for(var s=2&o&&n;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>r[e]=()=>n[e]));return r.default=()=>n,a.d(i,r),i},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.f={},a.e=e=>Promise.all(Object.keys(a.f).reduce(((t,n)=>(a.f[n](e,t),t)),[])),a.u=e=>e+".bundle.js",a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof shared)return shared}}(),a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n={},o="omniserver:",a.l=(e,t,i,r)=>{if(n[e])n[e].push(t);else{var s,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var p=c[d];if(p.getAttribute("src")==e||p.getAttribute("data-webpack")==o+i){s=p;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,a.nc&&s.setAttribute("nonce",a.nc),s.setAttribute("data-webpack",o+i),s.src=e),n[e]=[t];var u=(t,o)=>{s.onerror=s.onload=null,clearTimeout(h);var i=n[e];if(delete n[e],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(o))),t)return t(o)},h=setTimeout(u.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=u.bind(null,s.onerror),s.onload=u.bind(null,s.onload),l&&document.head.appendChild(s)}},a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&"SCRIPT"===t.currentScript.tagName.toUpperCase()&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var o=n.length-1;o>-1&&(!e||!/^http(s?):/.test(e));)e=n[o--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),(()=>{var e={792:0};a.f.j=(t,n)=>{var o=a.o(e,t)?e[t]:void 0;if(0!==o)if(o)n.push(o[2]);else{var i=new Promise(((n,i)=>o=e[t]=[n,i]));n.push(o[2]=i);var r=a.p+a.u(t),s=new Error;a.l(r,(n=>{if(a.o(e,t)&&(0!==(o=e[t])&&(e[t]=void 0),o)){var i=n&&("load"===n.type?"missing":n.type),r=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+i+": "+r+")",s.name="ChunkLoadError",s.type=i,s.request=r,o[1](s)}}),"chunk-"+t,t)}};var t=(t,n)=>{var o,i,[r,s,l]=n,c=0;if(r.some((t=>0!==e[t]))){for(o in s)a.o(s,o)&&(a.m[o]=s[o]);l&&l(a)}for(t&&t(n);c<r.length;c++)i=r[c],a.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunkomniserver=self.webpackChunkomniserver||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),a.nc=void 0,(()=>{"use strict";var e=a(72),t=a.n(e),n=a(825),o=a.n(n),i=a(659),r=a.n(i),s=a(56),l=a.n(s),c=a(540),d=a.n(c),p=a(113),u=a.n(p),h=a(674),w={};w.styleTagTransform=u(),w.setAttributes=l(),w.insert=r().bind(null,"head"),w.domAPI=o(),w.insertStyleElement=d(),t()(h.A,w),h.A&&h.A.locals&&h.A.locals;let f=shared.canvas=document.getElementById("canvas"),g=shared.ctx=f.getContext("2d");const m=shared.camera={x:0,y:0,scale:1,numControlledBy:0,z:1,basis1:[1,0,0],basis2:[0,1,0],normal:[0,0,1]};shared.defaultColors={tile:"#1f2229",background:"#323645",vignette:{inner:{size:.1,r:0,g:0,b:0,opacity:0},outer:{size:.6,r:0,g:0,b:0,opacity:1},innerInterp:{size:.1,r:0,g:0,b:0,opacity:0},outerInterp:{size:.6,r:0,g:0,b:0,opacity:1},holeFunctions:[]}},shared.colors={tile:shared.defaultColors.tile,background:shared.defaultColors.background,vignette:{inner:{size:.1,r:0,g:0,b:0,opacity:0},outer:{size:.6,r:0,g:0,b:0,opacity:1},innerInterp:{size:.1,r:0,g:0,b:0,opacity:0},outerInterp:{size:.6,r:0,g:0,b:0,opacity:1},holeFunctions:[]}},shared.selfId=void 0,shared.tileSize=100,shared.renderDebug=!1,shared.distortionsActive=!1,shared.skullImgLoaded=!1,shared.skullImg=void 0;let x,y,S,v,b,M=!1,A=!1,T=0,P=0,I=0,k=0,C=0,R=0,F=0;function D(e,t,n){return(1-n)*e+n*t}function L(e,t){b=g.globalAlpha,g.textAlign="center",g.textBaseline="middle",g.font=`${e.fontSize}px Inter`,g.translate(e.topLeft.x+e.dimensions.x/2,e.topLeft.y+e.dimensions.y/2),void 0!==e.rotation&&g.rotate(e.rotation),g.globalAlpha<.5&&(g.globalAlpha=.5),!0===g.toFill&&g.fillText(e.text,0,0),!0===g.toStroke?g.strokeText(e.text,0,0):!1===g.toFill&&(g.globalAlpha=1,g.fillStyle=t.tile,g.fillText(e.text,0,0)),void 0!==e.rotation&&g.rotate(-e.rotation),g.translate(-e.topLeft.x-e.dimensions.x/2,-e.topLeft.y-e.dimensions.y/2),g.globalAlpha=Math.min(.5,b)}shared.render=(e=shared.obstacles,t=shared.colors,n=shared.players)=>{if(document.body.style.backgroundColor=t.tile,M=!1,void 0!==shared.selfId){const e=n[shared.selfId];0===m.numControlledBy&&(m.x=e.pos.x,m.y=e.pos.y),!0===e.ship&&(g.translate(f.w/2,f.h/2),g.rotate(-Math.PI/2-e.shipAngle),g.translate(-f.w/2,-f.h/2),M=!0)}if(!0===M){g.fillStyle=t.tile,F=(f.w+f.h)/2,g.fillRect(-F,-F,4*F,4*F),I=m.x-F,k=m.x+F,C=m.y-F,R=m.y+F,g.fillStyle=t.background,g.fillRect(1-(m.x-f.w/2),1-(m.y-f.h/2),shared.mapDimensions.x-2,shared.mapDimensions.y-2),g.globalAlpha=.75,g.lineWidth=4.8,g.strokeStyle=t.tile,v=Math.sqrt(f.w**2+f.h**2),S=v/2%tileSize-tileSize-v/2;for(let e=(f.w/2-m.x)%tileSize+S;e<v+g.lineWidth+shared.tileSize;e+=shared.tileSize)g.beginPath(),g.moveTo(e,S),g.lineTo(e,f.h-S),g.stroke(),g.closePath();for(let e=(f.h/2-m.y)%tileSize+S;e<v+g.lineWidth+shared.tileSize;e+=shared.tileSize)g.beginPath(),g.moveTo(S,e),g.lineTo(f.w-S,e),g.stroke(),g.closePath()}else{g.fillStyle=t.tile,g.fillRect(0,0,f.w,f.h),I=m.x-f.w/2,k=m.x+f.w/2,C=m.y-f.h/2,R=m.y+f.h/2,g.fillStyle=t.background,g.fillRect(1-(m.x-f.w/2),1-(m.y-f.h/2),shared.mapDimensions.x-2,shared.mapDimensions.y-2),g.globalAlpha=.75,g.lineWidth=4.8,g.strokeStyle=t.tile;for(let e=(f.w/2-m.x)%tileSize;e<f.w+g.lineWidth+shared.tileSize;e+=shared.tileSize)g.beginPath(),g.moveTo(e,0),g.lineTo(e,f.h),g.stroke(),g.closePath();for(let e=(f.h/2-m.y)%tileSize;e<f.h+g.lineWidth+shared.tileSize;e+=shared.tileSize)g.beginPath(),g.moveTo(0,e),g.lineTo(f.w,e),g.stroke(),g.closePath()}g.globalAlpha=1,g.translate(-(m.x-f.w/2),-(m.y-f.h/2));for(let n=0;n<e.length;n++)void 0===e[n].cr?e[n].topLeft.x>k||e[n].topLeft.x+e[n].dimensions.x<I||e[n].topLeft.y>R||e[n].topLeft.y+e[n].dimensions.y<C||(y=e[n].effect.length,1===y?(A=0,g.toFill=!0,g.toStroke=!1,g.lineWidth=4,g.beginPath(),e[n].renderShape(e[n]),e[n].renderEffect[A](e[n]),!0===e[n].isText&&L(e[n],t),!0===g.toFill&&g.fill(),!0===g.toStroke&&g.stroke(),void 0!==g.cleanUpFunction&&(g.cleanUpFunction(),g.cleanUpFunction=void 0),g.closePath(),g.globalAlpha=1):(e[n].renderEffectTimer+=1/128,e[n].renderEffectTimer>=y&&(e[n].renderEffectTimer-=y),x=Math.floor(e[n].renderEffectTimer),A=x-1,-1===A&&(A=y-1),g.toFill=!0,g.toStroke=!1,g.lineWidth=2,g.beginPath(),e[n].renderShape(e[n]),e[n].renderEffect[A](e[n]),!0===e[n].isText&&L(e[n],t),g.globalAlpha=1,!0===g.toFill&&g.fill(),!0===g.toStroke&&g.stroke(),void 0!==g.cleanUpFunction&&(g.cleanUpFunction(),g.cleanUpFunction=void 0),g.closePath(),A=x,g.toFill=!0,g.toStroke=!1,g.lineWidth=2,g.beginPath(),e[n].renderShape(e[n]),e[n].renderEffect[A](e[n]),!0===e[n].isText&&L(e[n],t),g.globalAlpha=e[n].renderEffectTimer-x,!0===g.toFill&&g.fill(),!0===g.toStroke&&g.stroke(),void 0!==g.cleanUpFunction&&(g.cleanUpFunction(),g.cleanUpFunction=void 0),g.closePath(),g.globalAlpha=1)):e[n].cr(e[n]);for(let e=0;e<n.length;e++){const t=n[e];if(void 0===t)continue;g.fillStyle=!0===t.dead?"red":"black";const o=t.sat.r;if(t.sat.r=Math.abs(t.renderRadius),g.beginPath(),t.renderShape(t),t.renderRadius>=0)g.fill();else{const e=2*Math.PI*Math.abs(!0===t.dead?t.sat.r:void 0),n=Math.max(3,Math.floor(e/42));T=.96*T+2/7*e/n*.04,P=.96*P+5/7*e/n*.04,g.setLineDash([T,P]),g.lineDashOffset=-window.frames/1.56%e,g.strokeStyle=g.fillStyle,g.lineWidth=8,g.lineCap="round",g.stroke(),g.setLineDash([])}!0===t.god&&(g.strokeStyle="purple",g.lineWidth=10,g.stroke()),!0===t.ship&&(g.strokeStyle="#0033ed",g.lineWidth=10,g.lineCap="round",g.moveTo(t.pos.x,t.pos.y),g.lineTo(t.pos.x+Math.cos(t.shipAngle)*t.sat.r,t.pos.y+Math.sin(t.shipAngle)*t.sat.r),g.stroke()),!0===t.grapple&&(g.beginPath(),g.strokeStyle="#969696",g.globalAlpha=.75,g.lineWidth=12,g.arc(t.pos.x,t.pos.y,Math.abs(t.renderRadius)/2,0,2*Math.PI),-1===t.grappleX&&t.id===shared.selfId&&!0===input.action1?(g.strokeStyle="white",g.stroke(),g.closePath(),g.beginPath(),g.globalAlpha=.2,g.arc(t.pos.x,t.pos.y,t.grappleRange,0,2*Math.PI),g.stroke(),g.closePath()):-1!==t.grappleX?(g.strokeStyle="white",g.stroke(),g.closePath(),g.beginPath(),g.moveTo(t.pos.x,t.pos.y),g.lineTo(t.grappleX,t.grappleY),g.stroke(),g.closePath(),g.lineWidth=10,g.beginPath(),g.arc(t.grappleX,t.grappleY,10,0,2*Math.PI),g.stroke(),g.closePath()):(g.stroke(),g.closePath()),g.globalAlpha=1),!0===t.deathTimer&&(g.fillStyle="red",g.font="60px Inter",g.textAlign="center",g.textBaseline="middle",g.shadowBlur=2,g.shadowColor="red",g.fillText(~~(t.deathTime/60),t.pos.x,t.pos.y),g.shadowBlur=0),g.closePath(),g.fillStyle="white",g.font=(Math.abs(t.renderRadius)+.5)/25*15+"px Inter",g.textAlign="center",g.textBaseline="middle",g.fillText(t.name,t.pos.x,t.pos.y+4*t.renderRadius/3+3),t.sat.r=o}if(!0===shared.renderDebug){g.fillStyle="red",g.strokeStyle="red",g.lineWidth=2;for(let t=0;t<e.length;t++)e[t].topLeft.x>k||e[t].topLeft.x+e[t].dimensions.x<I||e[t].topLeft.y>R||e[t].topLeft.y+e[t].dimensions.y<C||(g.beginPath(),g.arc(e[t].pos.x,e[t].pos.y,10,0,2*Math.PI),g.fill(),g.closePath(),g.strokeRect(e[t].topLeft.x,e[t].topLeft.y,e[t].dimensions.x,e[t].dimensions.y));g.fillStyle="white",g.textAlign="center",g.textBaseline="middle";for(let e=0;e<n.length;e++){const t=n[e];void 0!==t&&(g.font=(Math.abs(t.renderRadius)+.5)/25*18+"px Inter",g.fillText(`(${50*Math.round(t.pos.x/50)},${50*Math.round(t.pos.y/50)})`,t.pos.x,t.pos.y-4*t.renderRadius/3-4.5))}}if(g.translate(m.x-f.w/2,m.y-f.h/2),void 0!==shared.selfId){const e=n[shared.selfId];!0===e.ship&&(g.translate(f.w/2,f.h/2),g.rotate(e.shipAngle+Math.PI/2),g.translate(-f.w/2,-f.h/2))}const o=shared.colors.vignette;for(let e in o.innerInterp)o.innerInterp[e]=D(o.innerInterp[e],o.inner[e],.03);for(let e in o.outerInterp)o.outerInterp[e]=D(o.outerInterp[e],o.outer[e],.03);g.beginPath();const i=g.createRadialGradient(f.w/2,f.h/2,f.w*o.innerInterp.size,f.w/2,f.h/2,f.w*o.outerInterp.size);if(i.addColorStop(0,`rgba(${o.innerInterp.r},${o.innerInterp.g},${o.innerInterp.b},${o.innerInterp.opacity})`),i.addColorStop(1,`rgba(${o.outerInterp.r},${o.outerInterp.g},${o.outerInterp.b},${o.outerInterp.opacity})`),g.fillStyle=i,g.rect(0,0,f.w,f.h),0!==o.holeFunctions.length){if(void 0!==shared.selfId){const e=n[shared.selfId];!0===e.ship&&(g.translate(f.w/2,f.h/2),g.rotate(-e.shipAngle-Math.PI/2),g.translate(-f.w/2,-f.h/2))}g.translate(f.w/2-m.x,f.h/2-m.y);for(let e=0;e<o.holeFunctions.length;e++)o.holeFunctions[e]();if(g.translate(m.x-f.w/2,m.y-f.h/2),void 0!==shared.selfId){const e=n[shared.selfId];!0===e.ship&&(g.translate(f.w/2,f.h/2),g.rotate(e.shipAngle+Math.PI/2),g.translate(-f.w/2,-f.h/2))}}g.fill("evenodd"),g.closePath(),shared.colors.vignette.inner={size:.1,r:0,g:0,b:0,opacity:0},shared.colors.vignette.outer={size:.6,r:0,g:0,b:0,opacity:1},shared.colors.vignette.holeFunctions.length=0,!0===shared.distortionsActive&&shared.renderGl()},shared.resizeFns=[];const O=document.querySelector(".gui");let E,U,z=1;function B(){z=shared.camera.scale,shared.changeCameraScale(1);const e=shared.devicePixelRatio;O.style.width=f.style.width=Math.ceil(window.innerWidth)+"px",O.style.height=f.style.height=Math.ceil(window.innerHeight)+"px",O.width=f.width=Math.ceil(window.innerWidth)*e,O.height=f.height=Math.ceil(window.innerHeight)*e,f.zoom=Math.max(.1,Math.round(Math.max(f.height,.5625*f.width)/1800*m.scale*100)/100),f.w=f.width/f.zoom,f.h=f.height/f.zoom,g.scale(f.zoom,f.zoom),g.lineJoin="round",g.lineCap="round";for(let e=0;e<shared.resizeFns.length;e++)shared.resizeFns[e]();shared.changeCameraScale(z)}shared.changeCameraScale=e=>{g.translate(-(1-1/shared.camera.scale)*f.w/2,-(1-1/shared.camera.scale)*f.h/2),g.translate(f.w/2,f.h/2),g.scale(1/shared.camera.scale,1/shared.camera.scale),g.translate(-f.w/2,-f.h/2),shared.camera.scale=e,f.w=f.width/f.zoom/shared.camera.scale,f.h=f.height/f.zoom/shared.camera.scale,g.translate(f.w/2,f.h/2),g.scale(shared.camera.scale,shared.camera.scale),g.translate(-f.w/2,-f.h/2),g.translate((1-1/shared.camera.scale)*f.w/2,(1-1/shared.camera.scale)*f.h/2)},window.addEventListener("resize",(function(){B()})),B(),shared.initDistortion=async(e,t,n=[],o=[])=>{void 0===E&&(E=(await a.e(964).then(a.bind(a,964))).default),E.initNonlinearTransform(e,t,n,o)},shared.unInitDistortion=()=>{void 0!==E&&E.unInitNonlinearTransform()},shared.importNoise=async()=>void 0!==U?U:U=(await a.e(417).then(a.bind(a,417))).default;let N=!1;var V,j;shared.importYoutube=async()=>{if(!0===N)return;const e=a.e(494).then(a.bind(a,494)),t=new Promise((e=>{const t=document.createElement("script");t.src="https://www.youtube.com/iframe_api",document.body.appendChild(t),shared.onYouTubeIframeAPIReady=()=>{e()}}));return N=!0,Promise.all([e,t])},shared.unTaintCanvas=()=>{const e=g.getTransform(),t=document.createElement("canvas");document.body.insertBefore(t,f),f.remove(),f=shared.canvas=t,g=shared.ctx=f.getContext("2d"),B(),g.setTransform(e)},V=void 0,j=function(e){try{t=new TextDecoder}catch(e){}var t,n,o,i,r,a,s,l,c=0,d={},p=0,u=0,h=[],w={useRecords:!1,mapsAsObjects:!0};class f{}let g=new f;g.name="MessagePack 0xC1";var m=!1,x=2;try{Function("")}catch(e){x=1/0}class y{constructor(e){e&&(!1===e.useRecords&&void 0===e.mapsAsObjects&&(e.mapsAsObjects=!0),!e.sequential||!1===e.trusted||(e.trusted=!0,e.structures||0==e.useRecords||(e.structures=[],e.maxSharedStructures||(e.maxSharedStructures=0))),e.structures?e.structures.sharedLength=e.structures.length:e.getStructures&&((e.structures=[]).uninitialized=!0,e.structures.sharedLength=0),e.int64AsNumber&&(e.int64AsType="number")),Object.assign(this,e)}unpack(e,t){if(n)return $((()=>(J(),this?this.unpack(e,t):y.prototype.unpack.call(w,e,t))));e.buffer||e.constructor!==ArrayBuffer||(e="undefined"!=typeof Buffer?Buffer.from(e):new Uint8Array(e)),"object"==typeof t?(o=t.end||e.length,c=t.start||0):(c=0,o=t>-1?t:e.length),u=0,r=null,a=null,n=e;try{l=e.dataView||(e.dataView=new DataView(e.buffer,e.byteOffset,e.byteLength))}catch(t){if(n=null,e instanceof Uint8Array)throw t;throw Error("Source must be a Uint8Array or Buffer but was a "+(e&&"object"==typeof e?e.constructor.name:typeof e))}return this instanceof y?(d=this,this.structures?i=this.structures:(!i||i.length>0)&&(i=[])):(d=w,(!i||i.length>0)&&(i=[])),S()}unpackMultiple(e,t){let n,o=0;try{m=!0;let i=e.length,r=this?this.unpack(e,i):K.unpack(e,i);if(!t){for(n=[r];c<i;)o=c,n.push(S());return n}if(!1===t(r,o,c))return;for(;c<i;)if(o=c,!1===t(S(),o,c))return}catch(e){throw e.lastPosition=o,e.values=n,e}finally{m=!1,J()}}_mergeStructures(e,t){Object.isFrozen(e=e||[])&&(e=e.map((e=>e.slice(0))));for(let t=0,n=e.length;t<n;t++){let n=e[t];n&&(n.isShared=!0,t>=32&&(n.highByte=t-32>>5))}for(let n in e.sharedLength=e.length,t||[])if(n>=0){let o=e[n],i=t[n];i&&(o&&((e.restoreStructures||(e.restoreStructures=[]))[n]=o),e[n]=i)}return this.structures=e}decode(e,t){return this.unpack(e,t)}}function S(e){try{if(!d.trusted&&!m){let e=i.sharedLength||0;e<i.length&&(i.length=e)}let e;if(d.randomAccessStructure&&n[c]<64&&n[c],e=b(),a&&(c=a.postBundlePosition,a=null),m&&(i.restoreStructures=null),c==o)i&&i.restoreStructures&&v(),i=null,n=null,s&&(s=null);else{if(c>o)throw Error("Unexpected end of MessagePack data");if(!m){let t;try{t=JSON.stringify(e,((e,t)=>"bigint"==typeof t?`${t}n`:t)).slice(0,100)}catch(e){t="(JSON view not available "+e+")"}throw Error("Data read, but end of buffer not reached "+t)}}return e}catch(e){throw i&&i.restoreStructures&&v(),J(),(e instanceof RangeError||e.message.startsWith("Unexpected end of buffer")||c>o)&&(e.incomplete=!0),e}}function v(){for(let e in i.restoreStructures)i[e]=i.restoreStructures[e];i.restoreStructures=null}function b(){let e=n[c++];if(e<160){if(e<128){if(e<64)return e;{let t=i[63&e]||d.getStructures&&P()[63&e];return t?(t.read||(t.read=A(t,63&e)),t.read()):e}}if(e<144){if(e-=128,d.mapsAsObjects){let t={};for(let n=0;n<e;n++){let e=j();"__proto__"===e&&(e="__proto_"),t[e]=b()}return t}{let t=new Map;for(let n=0;n<e;n++)t.set(b(),b());return t}}{let t=Array(e-=144);for(let n=0;n<e;n++)t[n]=b();return d.freezeData?Object.freeze(t):t}}if(e<192){let t=e-160;if(u>=c)return r.slice(c-p,(c+=t)-p);if(0==u&&o<140){let e=t<16?U(t):E(t);if(null!=e)return e}return I(t)}{let t;switch(e){case 192:return null;case 193:return a?(t=b())>0?a[1].slice(a.position1,a.position1+=t):a[0].slice(a.position0,a.position0-=t):g;case 194:return!1;case 195:return!0;case 196:if(void 0===(t=n[c++]))throw Error("Unexpected end of buffer");return B(t);case 197:return t=l.getUint16(c),c+=2,B(t);case 198:return t=l.getUint32(c),c+=4,B(t);case 199:return N(n[c++]);case 200:return t=l.getUint16(c),c+=2,N(t);case 201:return t=l.getUint32(c),c+=4,N(t);case 202:if(t=l.getFloat32(c),d.useFloat32>2){let e=q[(127&n[c])<<1|n[c+1]>>7];return c+=4,(e*t+(t>0?.5:-.5)|0)/e}return c+=4,t;case 203:return t=l.getFloat64(c),c+=8,t;case 204:return n[c++];case 205:return t=l.getUint16(c),c+=2,t;case 206:return t=l.getUint32(c),c+=4,t;case 207:return"number"===d.int64AsType?(t=4294967296*l.getUint32(c),t+=l.getUint32(c+4)):"string"===d.int64AsType?t=l.getBigUint64(c).toString():"auto"===d.int64AsType?(t=l.getBigUint64(c))<=BigInt(2)<<BigInt(52)&&(t=Number(t)):t=l.getBigUint64(c),c+=8,t;case 208:return l.getInt8(c++);case 209:return t=l.getInt16(c),c+=2,t;case 210:return t=l.getInt32(c),c+=4,t;case 211:return"number"===d.int64AsType?(t=4294967296*l.getInt32(c),t+=l.getUint32(c+4)):"string"===d.int64AsType?t=l.getBigInt64(c).toString():"auto"===d.int64AsType?(t=l.getBigInt64(c))>=BigInt(-2)<<BigInt(52)&&t<=BigInt(2)<<BigInt(52)&&(t=Number(t)):t=l.getBigInt64(c),c+=8,t;case 212:if(114==(t=n[c++]))return X(63&n[c++]);{let e=h[t];if(e)return e.read?(c++,e.read(b())):e.noBuffer?(c++,e()):e(n.subarray(c,++c));throw Error("Unknown extension "+t)}case 213:return 114==(t=n[c])?(c++,X(63&n[c++],n[c++])):N(2);case 214:return N(4);case 215:return N(8);case 216:return N(16);case 217:return t=n[c++],u>=c?r.slice(c-p,(c+=t)-p):k(t);case 218:return t=l.getUint16(c),u>=(c+=2)?r.slice(c-p,(c+=t)-p):shared.C(t);case 219:return t=l.getUint32(c),u>=(c+=4)?r.slice(c-p,(c+=t)-p):R(t);case 220:return t=l.getUint16(c),c+=2,D(t);case 221:return t=l.getUint32(c),c+=4,D(t);case 222:return t=l.getUint16(c),c+=2,L(t);case 223:return t=l.getUint32(c),c+=4,L(t);default:if(e>=224)return e-256;if(void 0===e){let e=Error("Unexpected end of MessagePack data");throw e.incomplete=!0,e}throw Error("Unknown MessagePack token "+e)}}}let M=/^[a-zA-Z_$][a-zA-Z\d_$]*$/;function A(e,t){function n(){if(n.count++>x){let n=e.read=Function("r","return function(){return "+(d.freezeData?"Object.freeze":"")+"({"+e.map((e=>"__proto__"===e?"__proto_:r()":M.test(e)?e+":r()":"["+JSON.stringify(e)+"]:r()")).join(",")+"})}")(b);return 0===e.highByte&&(e.read=T(t,e.read)),n()}let o={};for(let t=0,n=e.length;t<n;t++){let n=e[t];"__proto__"===n&&(n="__proto_"),o[n]=b()}return d.freezeData?Object.freeze(o):o}return n.count=0,0===e.highByte?T(t,n):n}let T=(e,t)=>function(){let o=n[c++];if(0===o)return t();let r=e<32?-(e+(o<<5)):e+(o<<5),a=i[r]||P()[r];if(!a)throw Error("Record id is not defined for "+r);return a.read||(a.read=A(a,e)),a.read()};function P(){let e=$((()=>(n=null,d.getStructures())));return i=d._mergeStructures(e,i)}var I=F,k=F,C=F,R=F;function F(e){let o;if(e<16&&(o=U(e)))return o;if(e>64&&t)return t.decode(n.subarray(c,c+=e));let i=c+e,r=[];for(o="";c<i;){let e=n[c++];if(128&e)if(192==(224&e)){let t=63&n[c++];r.push((31&e)<<6|t)}else if(224==(240&e)){let t=63&n[c++],o=63&n[c++];r.push((31&e)<<12|t<<6|o)}else if(240==(248&e)){let t=(7&e)<<18|(63&n[c++])<<12|(63&n[c++])<<6|63&n[c++];t>65535&&(t-=65536,r.push(t>>>10&1023|55296),t=56320|1023&t),r.push(t)}else r.push(e);else r.push(e);r.length>=4096&&(o+=O.apply(String,r),r.length=0)}return r.length>0&&(o+=O.apply(String,r)),o}function D(e){let t=Array(e);for(let n=0;n<e;n++)t[n]=b();return d.freezeData?Object.freeze(t):t}function L(e){if(d.mapsAsObjects){let t={};for(let n=0;n<e;n++){let e=j();"__proto__"===e&&(e="__proto_"),t[e]=b()}return t}{let t=new Map;for(let n=0;n<e;n++)t.set(b(),b());return t}}var O=String.fromCharCode;function E(e){let t=c,o=Array(e);for(let i=0;i<e;i++){let e=n[c++];if((128&e)>0)return void(c=t);o[i]=e}return O.apply(String,o)}function U(e){if(e<4){if(e<2){if(0===e)return"";{let e=n[c++];return(128&e)>1?void(c-=1):O(e)}}{let t=n[c++],o=n[c++];if((128&t)>0||(128&o)>0)return void(c-=2);if(e<3)return O(t,o);let i=n[c++];return(128&i)>0?void(c-=3):O(t,o,i)}}{let t=n[c++],o=n[c++],i=n[c++],r=n[c++];if((128&t)>0||(128&o)>0||(128&i)>0||(128&r)>0)return void(c-=4);if(e<6){if(4===e)return O(t,o,i,r);{let e=n[c++];return(128&e)>0?void(c-=5):O(t,o,i,r,e)}}if(e<8){let a=n[c++],s=n[c++];if((128&a)>0||(128&s)>0)return void(c-=6);if(e<7)return O(t,o,i,r,a,s);let l=n[c++];return(128&l)>0?void(c-=7):O(t,o,i,r,a,s,l)}{let a=n[c++],s=n[c++],l=n[c++],d=n[c++];if((128&a)>0||(128&s)>0||(128&l)>0||(128&d)>0)return void(c-=8);if(e<10){if(8===e)return O(t,o,i,r,a,s,l,d);{let e=n[c++];return(128&e)>0?void(c-=9):O(t,o,i,r,a,s,l,d,e)}}if(e<12){let p=n[c++],u=n[c++];if((128&p)>0||(128&u)>0)return void(c-=10);if(e<11)return O(t,o,i,r,a,s,l,d,p,u);let h=n[c++];return(128&h)>0?void(c-=11):O(t,o,i,r,a,s,l,d,p,u,h)}{let p=n[c++],u=n[c++],h=n[c++],w=n[c++];if((128&p)>0||(128&u)>0||(128&h)>0||(128&w)>0)return void(c-=12);if(e<14){if(12===e)return O(t,o,i,r,a,s,l,d,p,u,h,w);{let e=n[c++];return(128&e)>0?void(c-=13):O(t,o,i,r,a,s,l,d,p,u,h,w,e)}}{let f=n[c++],g=n[c++];if((128&f)>0||(128&g)>0)return void(c-=14);if(e<15)return O(t,o,i,r,a,s,l,d,p,u,h,w,f,g);let m=n[c++];return(128&m)>0?void(c-=15):O(t,o,i,r,a,s,l,d,p,u,h,w,f,g,m)}}}}}function z(){let e,t=n[c++];if(t<192)e=t-160;else switch(t){case 217:e=n[c++];break;case 218:e=l.getUint16(c),c+=2;break;case 219:e=l.getUint32(c),c+=4;break;default:throw Error("Expected string")}return F(e)}function B(e){return d.copyBuffers?Uint8Array.prototype.slice.call(n,c,c+=e):n.subarray(c,c+=e)}function N(e){let t=n[c++];if(h[t]){let o;return h[t](n.subarray(c,o=c+=e),(e=>{c=e;try{return b()}finally{c=o}}))}throw Error("Unknown extension type "+t)}var V=Array(4096);function j(){let e=n[c++];if(!(e>=160&&e<192))return c--,b().toString();if(e-=160,u>=c)return r.slice(c-p,(c+=e)-p);if(!(0==u&&o<180))return I(e);let t,i=4095&(e<<5^(e>1?l.getUint16(c):e>0?n[c]:0)),a=V[i],s=c,d=c+e-3,h=0;if(a&&a.bytes==e){for(;s<d;){if((t=l.getUint32(s))!=a[h++]){s=1879048192;break}s+=4}for(d+=3;s<d;)if((t=n[s++])!=a[h++]){s=1879048192;break}if(s===d)return c=s,a.string;d-=3,s=c}for(a=[],V[i]=a,a.bytes=e;s<d;)t=l.getUint32(s),a.push(t),s+=4;for(d+=3;s<d;)t=n[s++],a.push(t);let w=e<16?U(e):E(e);return a.string=null!=w?w:I(e)}let X=(e,t)=>{let n=b().map((e=>e.toString())),o=e;void 0!==t&&(e=e<32?-((t<<5)+e):(t<<5)+e,n.highByte=t);let r=i[e];return r&&(r.isShared||m)&&((i.restoreStructures||(i.restoreStructures=[]))[e]=r),i[e]=n,n.read=A(n,o),n.read()};h[0]=()=>{},h[0].noBuffer=!0;let Y={Error,TypeError,ReferenceError};h[101]=()=>{let e=b();return(Y[e[0]]||Error)(e[1])},h[105]=e=>{let t=l.getUint32(c-4);s||(s=new Map);let o,i=n[c];o=i>=144&&i<160||220==i||221==i?[]:{};let r={target:o};s.set(t,r);let a=b();return r.used?Object.assign(o,a):(r.target=a,a)},h[112]=e=>{let t=l.getUint32(c-4),n=s.get(t);return n.used=!0,n.target},h[115]=()=>new Set(b());let _=["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64","BigInt64","BigUint64"].map((e=>e+"Array")),W="object"==typeof globalThis?globalThis:shared;h[116]=e=>{let t=e[0],n=_[t];if(!n)throw Error("Could not find typed array for code "+t);return new W[n](Uint8Array.prototype.slice.call(e,1).buffer)},h[120]=()=>{let e=b();return RegExp(e[0],e[1])};let G=[];function $(e){let t=o,h=c,w=p,f=u,g=r,x=s,y=a,S=new Uint8Array(n.slice(0,o)),v=i,b=i.slice(0,i.length),M=d,A=m,T=e();return o=t,c=h,p=w,u=f,r=g,s=x,a=y,n=S,m=A,(i=v).splice(0,i.length,...b),d=M,l=new DataView(n.buffer,n.byteOffset,n.byteLength),T}function J(){n=null,s=null,i=null}h[98]=e=>{let t=(e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3],n=c;return c+=t-e.length,a=G,(a=[z(),z()]).position0=0,a.position1=0,a.postBundlePosition=c,c=n,b()},h[255]=e=>4==e.length?new Date(1e3*(16777216*e[0]+(e[1]<<16)+(e[2]<<8)+e[3])):8==e.length?new Date(((e[0]<<22)+(e[1]<<14)+(e[2]<<6)+(e[3]>>2))/1e6+1e3*(4294967296*(3&e[3])+16777216*e[4]+(e[5]<<16)+(e[6]<<8)+e[7])):12==e.length?new Date(((e[0]<<24)+(e[1]<<16)+(e[2]<<8)+e[3])/1e6+1e3*((128&e[4]?-281474976710656:0)+1099511627776*e[6]+4294967296*e[7]+16777216*e[8]+(e[9]<<16)+(e[10]<<8)+e[11])):new Date("invalid");let q=Array(147);for(let e=0;e<256;e++)q[e]=+("1e"+Math.floor(45.15-.30103*e));var K=new y({useRecords:!1});let H,Z=K.unpack,Q=K.unpackMultiple,ee=K.unpack,te={NEVER:0,ALWAYS:1,DECIMAL_ROUND:3,DECIMAL_FIT:4},ne=new Float32Array(1),oe=new Uint8Array(ne.buffer,0,4);try{H=new TextEncoder}catch(e){}let ie,re,ae,se,le,ce,de="undefined"!=typeof Buffer,pe=de?function(e){return Buffer.allocUnsafeSlow(e)}:Uint8Array,ue=de?Buffer:Uint8Array,he=de?4294967296:2144337920,we=0,fe=null,ge=/[\u0080-\uFFFF]/,me=Symbol("record-id");class xe extends y{constructor(e){super(e),this.offset=0;let t,n,o,i,r=ue.prototype.utf8Write?function(e,t){return ae.utf8Write(e,t,4294967295)}:!!H&&!!H.encodeInto&&function(e,t){return H.encodeInto(e,ae.subarray(t)).written},a=this;e||(e={});let s=e&&e.sequential,l=e.structures||e.saveStructures,c=e.maxSharedStructures;if(null==c&&(c=l?32:0),c>8160)throw Error("Maximum maxSharedStructure is 8160");e.structuredClone&&null==e.moreTypes&&(this.moreTypes=!0);let d=e.maxOwnStructures;null==d&&(d=l?32:64),this.structures||0==e.useRecords||(this.structures=[]);let p=c>32||d+c>64,u=c+64,h=c+d+64;if(h>8256)throw Error("Maximum maxSharedStructure + maxOwnStructure is 8192");let w=[],f=0,g=0;this.pack=this.encode=function(e,r){if(ae||(le=(ae=new pe(8192)).dataView||(ae.dataView=new DataView(ae.buffer,0,8192)),we=0),(ce=ae.length-10)-we<2048?(le=(ae=new pe(ae.length)).dataView||(ae.dataView=new DataView(ae.buffer,0,ae.length)),ce=ae.length-10,we=0):we=we+7&2147483640,t=we,r&De&&(we+=255&r),i=a.structuredClone?new Map:null,a.bundleStrings&&"string"!=typeof e?(fe=[]).size=1/0:fe=null,o=a.structures){o.uninitialized&&(o=a._mergeStructures(a.getStructures()));let e=o.sharedLength||0;if(e>c)throw Error("Shared structures is larger than maximum shared structures, try increasing maxSharedStructures to "+o.sharedLength);if(!o.transitions){o.transitions=Object.create(null);for(let t=0;t<e;t++){let e=o[t];if(!e)continue;let n,i=o.transitions;for(let t=0,o=e.length;t<o;t++){let o=e[t];(n=i[o])||(n=i[o]=Object.create(null)),i=n}i[me]=t+64}this.lastNamedStructuresLength=e}s||(o.nextId=e+64)}n&&(n=!1);try{a.randomAccessStructure&&e&&e.constructor&&e.constructor===Object?I(e):y(e);let n=fe;if(fe&&be(t,y,0),i&&i.idsToInsert){let e=i.idsToInsert.sort(((e,t)=>e.offset>t.offset?1:-1)),o=e.length,r=-1;for(;n&&o>0;){let i=e[--o].offset+t;i<n.stringsPosition+t&&-1===r&&(r=0),i>n.position+t?r>=0&&(r+=6):(r>=0&&(le.setUint32(n.position+t,le.getUint32(n.position+t)+r),r=-1),n=n.previous,o++)}r>=0&&n&&le.setUint32(n.position+t,le.getUint32(n.position+t)+r),(we+=6*e.length)>ce&&A(we),a.offset=we;let s=function(e,t){let n,o=6*t.length,i=e.length-o;for(;n=t.pop();){let t=n.offset,r=n.id;e.copyWithin(t+o,t,i);let a=t+(o-=6);e[a++]=214,e[a++]=105,e[a++]=r>>24,e[a++]=r>>16&255,e[a++]=r>>8&255,e[a++]=255&r,i=t}return e}(ae.subarray(t,we),e);return i=null,s}return a.offset=we,r&Re?(ae.start=t,ae.end=we,ae):ae.subarray(t,we)}finally{if(o&&(m(),n&&a.saveStructures)){var l,d;let n=o.sharedLength||0,i=ae.subarray(t,we),s=(d=a,(l=o).isCompatible=e=>{let t=!e||(d.lastNamedStructuresLength||0)===e.length;return t||d._mergeStructures(e),t},l);return!1===a.saveStructures(s,s.isCompatible)?a.pack(e,r):(a.lastNamedStructuresLength=n,i)}r&Fe&&(we=t)}};let m=()=>{g<10&&g++;let e=o.sharedLength||0;if(o.length>e&&!s&&(o.length=e),f>1e4)o.transitions=null,g=0,f=0,w.length>0&&(w=[]);else if(w.length>0&&!s){for(let e=0,t=w.length;e<t;e++)w[e][me]=0;w=[]}},x=e=>{var t=e.length;t<16?ae[we++]=144|t:t<65536?(ae[we++]=220,ae[we++]=t>>8,ae[we++]=255&t):(ae[we++]=221,le.setUint32(we,t),we+=4);for(let n=0;n<t;n++)y(e[n])},y=e=>{we>ce&&(ae=A(we));var n,o=typeof e;if("string"===o){let o,i=e.length;if(fe&&i>=4&&i<4096){if((fe.size+=i)>21760){let e,n,o=(fe[0]?3*fe[0].length+fe[1].length:0)+10;we+o>ce&&(ae=A(we+o)),fe.position?(n=fe,ae[we]=200,we+=3,ae[we++]=98,e=we-t,we+=4,be(t,y,0),le.setUint16(e+t-3,we-t-e)):(ae[we++]=214,ae[we++]=98,e=we-t,we+=4),(fe=["",""]).previous=n,fe.size=0,fe.position=e}let n=ge.test(e);return fe[n?0:1]+=e,ae[we++]=193,void y(n?-i:i)}o=i<32?1:i<256?2:i<65536?3:5;let a=3*i;if(we+a>ce&&(ae=A(we+a)),i<64||!r){let t,r,a,s=we+o;for(t=0;t<i;t++)(r=e.charCodeAt(t))<128?ae[s++]=r:r<2048?(ae[s++]=r>>6|192,ae[s++]=63&r|128):55296==(64512&r)&&56320==(64512&(a=e.charCodeAt(t+1)))?(r=65536+((1023&r)<<10)+(1023&a),t++,ae[s++]=r>>18|240,ae[s++]=r>>12&63|128,ae[s++]=r>>6&63|128,ae[s++]=63&r|128):(ae[s++]=r>>12|224,ae[s++]=r>>6&63|128,ae[s++]=63&r|128);n=s-we-o}else n=r(e,we+o);n<32?ae[we++]=160|n:n<256?(o<2&&ae.copyWithin(we+2,we+1,we+1+n),ae[we++]=217,ae[we++]=n):n<65536?(o<3&&ae.copyWithin(we+3,we+2,we+2+n),ae[we++]=218,ae[we++]=n>>8,ae[we++]=255&n):(o<5&&ae.copyWithin(we+5,we+3,we+3+n),ae[we++]=219,le.setUint32(we,n),we+=4),we+=n}else if("number"===o)if(e>>>0===e)e<32||e<128&&!1===this.useRecords||e<64&&!this.randomAccessStructure?ae[we++]=e:e<256?(ae[we++]=204,ae[we++]=e):e<65536?(ae[we++]=205,ae[we++]=e>>8,ae[we++]=255&e):(ae[we++]=206,le.setUint32(we,e),we+=4);else if((0|e)===e)e>=-32?ae[we++]=256+e:e>=-128?(ae[we++]=208,ae[we++]=e+256):e>=-32768?(ae[we++]=209,le.setInt16(we,e),we+=2):(ae[we++]=210,le.setInt32(we,e),we+=4);else{let t;if((t=this.useFloat32)>0&&e<4294967296&&e>=-2147483648){let n;if(ae[we++]=202,le.setFloat32(we,e),t<4||(0|(n=e*q[(127&ae[we])<<1|ae[we+1]>>7]))===n)return void(we+=4);we--}ae[we++]=203,le.setFloat64(we,e),we+=8}else if("object"===o||"function"===o)if(e){if(i){let n=i.get(e);if(n){if(!n.id){let e=i.idsToInsert||(i.idsToInsert=[]);n.id=e.push(n)}return ae[we++]=214,ae[we++]=112,le.setUint32(we,n.id),void(we+=4)}i.set(e,{offset:we-t})}let r=e.constructor;if(r===Object)M(e,!0);else if(r===Array)x(e);else if(r===Map)if(this.mapAsEmptyObject)ae[we++]=128;else for(let[t,o]of((n=e.size)<16?ae[we++]=128|n:n<65536?(ae[we++]=222,ae[we++]=n>>8,ae[we++]=255&n):(ae[we++]=223,le.setUint32(we,n),we+=4),e))y(t),y(o);else{for(let t=0,n=ie.length;t<n;t++)if(e instanceof re[t]){let n=ie[t];if(n.write){n.type&&(ae[we++]=212,ae[we++]=n.type,ae[we++]=0);let t=n.write.call(this,e);return void(t===e?Array.isArray(e)?x(e):M(e):y(t))}let o,i=ae,r=le,a=we;ae=null;try{o=n.pack.call(this,e,(e=>(ae=i,i=null,(we+=e)>ce&&A(we),{target:ae,targetView:le,position:we-e})),y)}finally{i&&(ae=i,le=r,we=a,ce=ae.length-10)}return void(o&&(o.length+we>ce&&A(o.length+we),we=ve(o,ae,we,n.type)))}if(Array.isArray(e))x(e);else{if(e.toJSON){let t=e.toJSON();if(t!==e)return y(t)}if("function"===o)return y(this.writeFunction&&this.writeFunction(e));M(e,!e.hasOwnProperty)}}}else ae[we++]=192;else if("boolean"===o)ae[we++]=e?195:194;else if("bigint"===o){if(e<BigInt(1)<<BigInt(63)&&e>=-(BigInt(1)<<BigInt(63)))ae[we++]=211,le.setBigInt64(we,e);else if(e<BigInt(1)<<BigInt(64)&&e>0)ae[we++]=207,le.setBigUint64(we,e);else{if(!this.largeBigIntToFloat)throw RangeError(e+" was too large to fit in MessagePack 64-bit integer format, set largeBigIntToFloat to convert to float-64");ae[we++]=203,le.setFloat64(we,Number(e))}we+=8}else{if("undefined"!==o)throw Error("Unknown type: "+o);this.encodeUndefinedAsNil?ae[we++]=192:(ae[we++]=212,ae[we++]=0,ae[we++]=0)}},S=this.variableMapSize||this.coercibleKeyAsNumber?e=>{let t,n=Object.keys(e),o=n.length;if(o<16?ae[we++]=128|o:o<65536?(ae[we++]=222,ae[we++]=o>>8,ae[we++]=255&o):(ae[we++]=223,le.setUint32(we,o),we+=4),this.coercibleKeyAsNumber)for(let i=0;i<o;i++){let o=Number(t=n[i]);y(isNaN(o)?t:o),y(e[t])}else for(let i=0;i<o;i++)y(t=n[i]),y(e[t])}:(e,n)=>{ae[we++]=222;let o=we-t;we+=2;let i=0;for(let t in e)(n||e.hasOwnProperty(t))&&(y(t),y(e[t]),i++);ae[o+++t]=i>>8,ae[o+t]=255&i},v=!1===this.useRecords?S:e.progressiveRecords&&!p?(e,n)=>{let i,r,a=o.transitions||(o.transitions=Object.create(null)),s=we++-t;for(let l in e)if(n||e.hasOwnProperty(l)){if(i=a[l])a=i;else{let n=Object.keys(e),c=a;a=o.transitions;let d=0;for(let e=0,t=n.length;e<t;e++){let t=n[e];!(i=a[t])&&(i=a[t]=Object.create(null),d++),a=i}s+t+1==we?(we--,T(a,n,d)):P(a,n,s,d),r=!0,a=c[l]}y(e[l])}if(!r){let n=a[me];n?ae[s+t]=n:P(a,Object.keys(e),s,0)}}:(e,t)=>{let n,i=o.transitions||(o.transitions=Object.create(null)),r=0;for(let o in e)(t||e.hasOwnProperty(o))&&(!(n=i[o])&&(n=i[o]=Object.create(null),r++),i=n);let a=i[me];for(let n in a?a>=96&&p?(ae[we++]=96+(31&(a-=96)),ae[we++]=a>>5):ae[we++]=a:T(i,i.__keys__||Object.keys(e),r),e)(t||e.hasOwnProperty(n))&&y(e[n])},b="function"==typeof this.useRecords&&this.useRecords,M=b?(e,t)=>{b(e)?v(e,t):S(e,t)}:v,A=e=>{let n;if(e>16777216){if(e-t>he)throw Error("Packed buffer would be larger than maximum buffer size");n=Math.min(he,4096*Math.round(Math.max((e-t)*(e>67108864?1.25:2),4194304)/4096))}else n=1+(Math.max(e-t<<2,ae.length-1)>>12)<<12;let o=new pe(n);return le=o.dataView||(o.dataView=new DataView(o.buffer,0,n)),e=Math.min(e,ae.length),ae.copy?ae.copy(o,0,t,e):o.set(ae.slice(t,e)),we-=t,t=0,ce=o.length-10,ae=o},T=(e,t,i)=>{let r=o.nextId;r||(r=64),r<u&&this.shouldShareStructure&&!this.shouldShareStructure(t)?((r=o.nextOwnId)<h||(r=u),o.nextOwnId=r+1):(r>=h&&(r=u),o.nextId=r+1);let a=t.highByte=r>=96&&p?r-96>>5:-1;e[me]=r,e.__keys__=t,o[r-64]=t,r<u?(t.isShared=!0,o.sharedLength=r-63,n=!0,a>=0?(ae[we++]=96+(31&r),ae[we++]=a):ae[we++]=r):(a>=0?(ae[we++]=213,ae[we++]=114,ae[we++]=96+(31&r),ae[we++]=a):(ae[we++]=212,ae[we++]=114,ae[we++]=r),i&&(f+=g*i),w.length>=d&&(w.shift()[me]=0),w.push(e),y(t))},P=(e,n,o,i)=>{let r=ae,a=we,s=ce,l=t;ae=se,we=0,t=0,ae||(se=ae=new pe(8192)),ce=ae.length-10,T(e,n,i),se=ae;let c=we;if(ae=r,we=a,ce=s,t=l,c>1){let e=we+c-1;e>ce&&A(e);let n=o+t;ae.copyWithin(n+c,n+1,we),ae.set(se.slice(0,c),n),we=e}else ae[o+t]=se[0]},I=(e,i)=>{let r=(void 0)(e,ae,t,we,o,A,((e,t,o)=>{if(o)return n=!0;we=t;let i=ae;return y(e),m(),i!==ae?{position:we,targetView:le,target:ae}:we}),this);if(0===r)return M(e,!0);we=r}}useBuffer(e){ae=e,le=new DataView(ae.buffer,ae.byteOffset,ae.byteLength),we=0}clearSharedData(){this.structures&&(this.structures=[]),this.typedStructs&&(this.typedStructs=[])}}function ye(e,t,n,o){let i=e.byteLength;if(i+1<256){var{target:r,position:a}=n(4+i);r[a++]=199,r[a++]=i+1}else if(i+1<65536){var{target:r,position:a}=n(5+i);r[a++]=200,r[a++]=i+1>>8,r[a++]=i+1&255}else{var{target:r,position:a,targetView:s}=n(7+i);r[a++]=201,s.setUint32(a,i+1),a+=4}r[a++]=116,r[a++]=t,r.set(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),a)}function Se(e,t){let n=e.byteLength;if(n<256){var o,i,{target:o,position:i}=t(n+2);o[i++]=196,o[i++]=n}else if(n<65536){var{target:o,position:i}=t(n+3);o[i++]=197,o[i++]=n>>8,o[i++]=255&n}else{var{target:o,position:i,targetView:r}=t(n+5);o[i++]=198,r.setUint32(i,n),i+=4}o.set(e,i)}function ve(e,t,n,o){let i=e.length;switch(i){case 1:t[n++]=212;break;case 2:t[n++]=213;break;case 4:t[n++]=214;break;case 8:t[n++]=215;break;case 16:t[n++]=216;break;default:i<256?(t[n++]=199,t[n++]=i):i<65536?(t[n++]=200,t[n++]=i>>8,t[n++]=255&i):(t[n++]=201,t[n++]=i>>24,t[n++]=i>>16&255,t[n++]=i>>8&255,t[n++]=255&i)}return t[n++]=o,t.set(e,n),n+i}function be(e,t,n){if(fe.length>0){le.setUint32(fe.position+e,we+n-fe.position-e),fe.stringsPosition=we-e;let o=fe;fe=null,t(o[0]),t(o[1])}}re=[Date,Set,Error,RegExp,ArrayBuffer,Object.getPrototypeOf(Uint8Array.prototype).constructor,f],ie=[{pack(e,t,n){let o=e.getTime()/1e3;if((this.useTimestamp32||0===e.getMilliseconds())&&o>=0&&o<4294967296){let{target:e,targetView:n,position:i}=t(6);e[i++]=214,e[i++]=255,n.setUint32(i,o)}else if(o>0&&o<4294967296){let{target:n,targetView:i,position:r}=t(10);n[r++]=215,n[r++]=255,i.setUint32(r,4e6*e.getMilliseconds()+(o/1e3/4294967296|0)),i.setUint32(r+4,o)}else if(isNaN(o)){if(this.onInvalidDate)return t(0),n(this.onInvalidDate());let{target:e,targetView:o,position:i}=t(3);e[i++]=212,e[i++]=255,e[i++]=255}else{let{target:n,targetView:i,position:r}=t(15);n[r++]=199,n[r++]=12,n[r++]=255,i.setUint32(r,1e6*e.getMilliseconds()),i.setBigInt64(r+4,BigInt(Math.floor(o)))}}},{pack(e,t,n){if(this.setAsEmptyObject)return t(0),n({});let o=Array.from(e),{target:i,position:r}=t(this.moreTypes?3:0);this.moreTypes&&(i[r++]=212,i[r++]=115,i[r++]=0),n(o)}},{pack(e,t,n){let{target:o,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(o[i++]=212,o[i++]=101,o[i++]=0),n([e.name,e.message])}},{pack(e,t,n){let{target:o,position:i}=t(this.moreTypes?3:0);this.moreTypes&&(o[i++]=212,o[i++]=120,o[i++]=0),n([e.source,e.flags])}},{pack(e,t){this.moreTypes?ye(e,16,t):Se(de?Buffer.from(e):new Uint8Array(e),t)}},{pack(e,t){let n=e.constructor;n!==ue&&this.moreTypes?ye(e,_.indexOf(n.name),t):Se(e,t)}},{pack(e,t){let{target:n,position:o}=t(1);n[o]=193}}];let Me=new xe({useRecords:!1}),Ae=Me.pack,Te=Me.pack,{NEVER:Pe,ALWAYS:Ie,DECIMAL_ROUND:ke,DECIMAL_FIT:Ce}=te,Re=512,Fe=1024,De=2048;e.ALWAYS=Ie,e.C1=g,e.DECIMAL_FIT=Ce,e.DECIMAL_ROUND=ke,e.Decoder=y,e.Encoder=xe,e.FLOAT32_OPTIONS=te,e.NEVER=Pe,e.Packr=xe,e.REUSE_BUFFER_MODE=Re,e.Unpackr=y,e.addExtension=function(e){var t;if(e.Class){if(!e.pack&&!e.write)throw Error("Extension has no pack or write function");if(e.pack&&!e.type)throw Error("Extension has no type (numeric code to identify the extension)");re.unshift(e.Class),ie.unshift(e)}(t=e).unpack?h[t.type]=t.unpack:h[t.type]=t},e.clearSource=J,e.decode=ee,e.decodeIter=function(e,t={}){if(!e||"object"!=typeof e)throw Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a promise");let n,o=new y(t),i=e=>{let t;n&&(e=Buffer.concat([n,e]),n=void 0);try{t=o.unpackMultiple(e)}catch(o){if(!o.incomplete)throw o;n=e.slice(o.lastPosition),t=o.values}return t};return"function"==typeof e[Symbol.iterator]?function*(){for(let t of e)yield*i(t)}():"function"==typeof e[Symbol.asyncIterator]?async function*(){for await(let t of e)yield*i(t)}():void 0},e.encode=Te,e.encodeIter=function(e,t={}){if(e&&"object"==typeof e){if("function"==typeof e[Symbol.iterator])return function*(e,t){let n=new xe(t);for(let t of e)yield n.pack(t)}(e,t);if("function"==typeof e.then||"function"==typeof e[Symbol.asyncIterator])return async function*(e,t){let n=new xe(t);for await(let t of e)yield n.pack(t)}(e,t);throw Error("first argument must be an Iterable, Async Iterable, Iterator, Async Iterator, or a Promise")}throw Error("first argument must be an Iterable, Async Iterable, or a Promise for an Async Iterable")},e.isNativeAccelerationEnabled=!1,e.mapsAsObjects=!0,e.pack=Ae,e.roundFloat32=function(e){ne[0]=e;let t=q[(127&oe[3])<<1|oe[2]>>7];return(t*e+(e>0?.5:-.5)|0)/t},e.unpack=Z,e.unpackMultiple=Q,e.useRecords=!1},"object"==typeof exports&&"undefined"!=typeof module?j(exports):"function"==typeof define&&define.amd?define(["exports"],j):j((V="undefined"!=typeof globalThis?globalThis:V||self).msgpackr={});const X=Object.freeze({sensitivity:13e3,minAvgSpeed:650,maxScrollTime:150,edgeMargin:117}),Y=shared.environment="undefined"==typeof location?"server":location.origin.endsWith("8080")||location.href.endsWith("editor")?"editor":"client",_={};function W(e,t,n){const o=e+"_"+t+"_"+n;if(void 0!==_[o])return _[o];const i=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16),s=parseInt(t.slice(1,3),16),l=parseInt(t.slice(3,5),16),c=parseInt(t.slice(5,7),16),d=(p=Math.floor(i*(1-n)+s*n),u=Math.floor(r*(1-n)+l*n),h=Math.floor(a*(1-n)+c*n),"#"+G(p)+G(u)+G(h));var p,u,h;return _[o]=d,d}function G(e){var t=e.toString(16);return 1==t.length?"0"+t:t}shared.blendColor=W,shared.jewelBoxUrl="https://upload.wikimedia.org/wikipedia/commons/c/c3/A_Snapshot_of_the_Jewel_Box_cluster_with_the_ESO_VLT.jpg",shared.decorationImgs={},"undefined"!=typeof Image?(shared.arrowImg=new Image,shared.starImg=new Image,shared.starImg.crossOrigin="Anonymous","editor"===Y?(async()=>{const e=await a.e(254).then(a.bind(a,230));shared.arrowImg=e.default.arrowImg,shared.starImg=e.default.starImg})():(shared.arrowImg.src="./gfx/arrow.png",shared.starImg.src=shared.jewelBoxUrl)):shared.arrowImg=shared.starImg={},shared.colourRgb=(e,t,n)=>(e=2.55*Math.max(Math.min(Number(e),100),0),t=2.55*Math.max(Math.min(Number(t),100),0),n=2.55*Math.max(Math.min(Number(n),100),0),"#"+(e=("0"+(Math.round(e)||0).toString(16)).slice(-2))+(t=("0"+(Math.round(t)||0).toString(16)).slice(-2))+("0"+(Math.round(n)||0).toString(16)).slice(-2)),"server"===Y&&(global.colourRgb=shared.colourRgb),shared.md=e=>e!=e||null==e?0:e,shared.makeNumber=e=>!0===Number.isFinite(e)?e:0,shared.makeNotNaN=e=>e==e?e:0,shared.makeNotNull=e=>null===e?0:e,shared.makeNotUndefined=e=>void 0===e?0:e,shared.rlt=e=>(shared.loopTrap=1e3,e),shared.makeType=(e,t)=>!0===t.includes(generateConnectionType(e))?e:$[typeof e],shared.generateConnectionType=e=>{const t=typeof e;return"number"===t?"Number":"string"===t?["String","Colour"]:"boolean"===t?"Boolean":!0===Array.isArray(e)?"Array":null};const $={undefined:0,string:"",boolean:!0,number:0,object:[]},J=new TextEncoder,q=new TextDecoder,K={until:(e,t=400)=>!!e()||new Promise((n=>{let o=setInterval((()=>{e()&&(clearInterval(o),n())}),t)})),SCROLL_PARAMS:X,blendColor:W,environment:Y,encodeAtPosition:function(e,t,n){return J.encodeInto(e,n?t.subarray(0|n):t)},decodeText:function(e,t=0){return q.decode(e).slice(t)}},{decodeText:H}=K,Z=location.origin.replace(/^http/,"ws");let Q,ee,te=!1;const ne=[];shared.send=e=>{ne.push(e)},Q=new WebSocket(Z),Q.binaryType="arraybuffer",Q.addEventListener("message",(function(e){if(void 0!==ee)return oe[ee](e.data),void(ee=void 0);const t=new Uint8Array(e.data);void 0===oe[t[0]]&&console.log(t),oe[t[0]](t)})),Q.onopen=()=>{console.log("connected to the server!"),shared.send=e=>{Q.send(e)};for(let e=0;e<ne.length;e++)send(ne[e])},Q.onclose=()=>{console.log("Websocket closed."),shared.send=()=>{}},shared.changeMap=function(e="/maps/hub",t="GET",n=new Headers){n.append("id",shared.authId),fetch(location.origin+e,{method:t,headers:n}).then((async t=>{const n=await t.text();if("n"===n)return void console.error(`failed to load map url ${e}`);const[o,i]=JSON.parse(t.headers.get("X-Init-Data")),r=document.getElementById("gameScript");null!==r&&r.remove(),shared.resetGame(),shared.mapPath=e,shared.players.length=shared.obstacles.length=0;const a=document.createElement("script");a.id="gameScript",a.text=n,document.body.appendChild(a);for(let e=0;e<o.length;e++){if(void 0===o[e]||null===o[e]){shared.players[e]=void 0;continue}const t=ie(o[e]);shared.players[e]=t}shared.selfId=i,shared.won=!1,te?shared.respawnPlayer():(shared.startGame(),te=!0)}))};const oe=[e=>{const t=new Uint32Array(e.buffer);shared.authId=t[1];const n=localStorage.getItem("username"),o=localStorage.getItem("password");if(null===n||null===o)shared.onkeydown({code:"KeyZ",repeat:!1,type:"keydown"}),shared.changeMap("/tutorial");else{const e=new Headers;e.append("u",n),e.append("p",o),shared.changeMap("/join","POST",e)}},()=>{location.reload()},e=>{location.replace(location.origin+"/create")},e=>{ee=e[1]},e=>{const t=e.buffer,n=new Uint16Array(t)[1];if(n===shared.selfId)return;const o=new Float32Array(t);shared.players[n].pos.x=o[1],shared.players[n].pos.y=o[2]},e=>{let t=ie(msgpackr.unpack(e));shared.players[t.id]=t},e=>{let t=new Uint16Array(e.buffer)[1];shared.players[t]=void 0},e=>{const t=H(e,2),n=["normal","system","dev","guest"][e[1]],o=document.createElement("div");"system"!==n?o.classList.add("chat-message"):o.classList.add("system-message"),o.innerHTML=`${"system"===n?'<span class="rainbow">[SERVER]</span>':"dev"===n?'<span class="rainbow">[DEV]</span> ':""}${"guest"===n?'<span class="guest">':""}${t}${"guest"===n?"</span>":""}`;const i=document.querySelector(".chat-div");i.appendChild(o),i.scrollTop=i.scrollHeight},e=>{const t=new Uint16Array(e.buffer)[1];t!==shared.selfId&&(shared.players[t].god=1===e[1])},e=>{const t=new Uint16Array(e.buffer)[1];if(t===shared.selfId)return;const n=new Float32Array(e.buffer);shared.players[t].ship=!0,shared.players[t].shipAngle=n[1]},e=>{const t=new Uint16Array(e.buffer)[1];t!==shared.selfId&&(shared.players[t].ship=!1)},e=>{const t=new Uint16Array(e.buffer)[1];if(t===shared.selfId)return;const n=new Float32Array(e.buffer);shared.players[t].grapple=!0,shared.players[t].grappleX=n[1],shared.players[t].grappleY=n[2]},e=>{const t=new Uint16Array(e.buffer)[1];t!==shared.selfId&&(shared.players[t].grapple=!1)},e=>{const t=new Uint16Array(e.buffer)[1];if(t===shared.selfId)return;const n=new Float32Array(e.buffer);shared.players[t].deathTimer=!0,shared.players[t].deathTime=n[1]},e=>{const t=new Uint16Array(e.buffer)[1];t!==shared.selfId&&(shared.players[t].deathTimer=!1)},e=>{const t=new Uint16Array(e.buffer)[1];t!==shared.selfId&&(shared.players[t].dead=1===e[1])}];function ie(e){const t=shared.createPlayer();return t.pos.x=e.pos.x,t.pos.y=e.pos.y,t.name=e.name,t.dead=e.dead,t.id=e.id,t.god=e.god,t.ship=e.ship,t.shipAngle=e.shipAngle,t.grapple=e.grapple,t.grappleX=e.grappleX,t.grappleY=e.grappleY,t.deathTimer=e.deathTimer,t.deathTime=e.deathTime,t}const{until:re,environment:ae}=K;let se;const le=()=>void 0!==se;let ce=!0==("undefined"==typeof location)?"":`${location.origin}/game`,de=!1,pe="",ue=[],he=[];if(shared.levelFileName="",shared.isExClient=!0,"editor"===ae||"server"===ae||!0===shared.isExClient)ge=async()=>{await re((()=>!1))},fe=()=>{};else if(!0===location.href.includes("standalone")){shared.standalone=!0;const e=location.href.split("/");ce+="/"+e[e.length-1],fe=()=>{}}else if(null===localStorage.getItem("tutorialCompleted")){let e=!1;ge=async()=>(await re((()=>!1!==e)),ge()),shared.tutorial=!0,(async()=>{ge=(await a.e(186).then(a.bind(a,186))).default,e=!0})()}ge().then((async e=>{se=e,xe(),!0!==shared.standalone?se=await we:ge=async()=>{await re((()=>!1))}}));let we=ge();async function fe(e=!1){if(!0!==de){if(!0===e){if(0===ue.length)return;var t=se;he.push(shared.levelFileName),se=await me(ue.pop())}else""!==shared.levelFileName&&(ue.push(shared.levelFileName),ue.length>42&&ue.shift(),0!==he.length&&(se=await me(he.pop())));shared.scrollingUp=!0===e,shared.lastObstacles=[];for(let e=0;e<obstacles.length;e++)shared.lastObstacles.push(obstacles[e]);for(let e in shared.colors)shared.lastColors[e]=shared.colors[e],shared.colors[e]=shared.defaultColors[e];shared.lastPlayerData=[player.pos.x,player.pos.y],void 0!==se?(xe(),shared.scrollAnimation=0,se=!0===e?t:await ge()):(de=!0,removeScript(),shared.scrollAnimation=0,await re(le,16.66),xe(),de=!1,se=await ge())}}async function ge(){const e=await fetch(ce);if(!e.ok)throw new Error(`Failed to fetch ${ce}`);return pe=e.headers.get("Fn"),e.text()}async function me(e){const t=e.slice(0,e.length-3),n=await fetch(ce+"/"+t);if(!n.ok)throw new Error(`Failed to fetch ${ce}`);return pe=e,n.text()}async function xe(){removeScript(),shared.resetGame(),stopMusic();const e=document.createElement("script");e.id="gameScript",e.text=se,document.body.appendChild(e),se=void 0,shared.levelFileName=pe}shared.won=!1,shared.removeScript=function(){const e=document.getElementById("gameScript");null!==e&&e.remove(),shared.resetGame(),stopMusic()},shared.resetFns=[],shared.resetGame=()=>{for(let e=0;e<shared.resetFns.length;e++)shared.resetFns[e]();shared.resetFns.length=shared.obstacles.length=shared.mouseUpFunctions.length=shared.mouseDownFunctions.length=shared.mouseMoveFunctions.length=shared.resizeFns.length=0,"editor"!==shared.environment?shared.respawnPlayer():shared.infiniteLoop=!1;for(let e in shared.defaultColors)shared.colors[e]=shared.defaultColors[e];void 0!==shared.colors.vignette&&(shared.colors.vignette=structuredClone(shared.defaultColors.vignette)),shared.mouseDownFunctions.push((()=>{!0===e.dead&&shared.respawnPlayer()})),shared.changeCameraScale(1),void 0!==shared.addSideMenuEvtListeners&&shared.addSideMenuEvtListeners(pe),shared.spawnPosition.x=100,shared.spawnPosition.y=1500;const e=shared.players[shared.selfId];void 0!==e&&(e.sat.r=49.5,e.speed=e.baseSpeed=.43),shared.idToObs={}};const ye=fe,{environment:Se,blendColor:ve,encodeAtPosition:be}=K;let Me=!1;shared.respawnPlayer=()=>{const e=shared.players[shared.selfId];void 0!==e&&(e.pos.x=shared.spawnPosition.x,e.pos.y=shared.spawnPosition.y,e.renderRadius=0,e.dead=!1,e.forces.length=0,!0===dragging?(shared.onmouseup(),dragging=!0):shared.onmouseup())};const Ae=shared.SAT;function Te(e,t,n,o){const i={sat:Le[e](o),simulate:[],effect:[],renderShape:Be[e],renderEffect:n.map((e=>Ge[e])),renderEffectTimer:0};i.pos=i.sat.pos,0===e?i.sat.r=Math.max(i.sat.r,.001):3===e?(i.isText=!0,i.text=o.text,i.fontSize=o.fontSize):4===e&&(i.sat.r=Math.max(i.sat.r,.001),i.innerRadius=Math.max(o.innerRadius,0),i.startSlice=o.startSlice,i.startSliceAngle=o.startSliceAngle,i.endSlice=o.endSlice,i.endSliceAngle=o.endSliceAngle,i.startSliceAngleRotateSpeed=o.startSliceAngleRotateSpeed,i.endSliceAngleRotateSpeed=o.endSliceAngleRotateSpeed,void 0!==o.circleSliceRotate&&i.simulate.push(o.circleSliceRotate));for(let t in shared.satConstraintsMap[e]){const n=shared.satConstraintsMap[e][t];!0===n[2]&&(i[t]=Math.round(i[t])),i[t]<n[0]?i[t]=n[0]:i[t]>n[1]&&(i[t]=n[1])}i.dimensions=Ee(i),i.topLeft=Ue(i);for(let e=0;e<t.length;e++){i.simulate.push(Ve[t[e]]),Ne[t[e]](i,o);for(let n in shared.simulateConstraintsMap[t[e]]){const o=shared.simulateConstraintsMap[t[e]][n];!0===o[2]&&(i[n]=Math.round(i[n])),i[n]<o[0]?i[n]=o[0]:i[n]>o[1]&&(i[n]=o[1])}}for(let e=0;e<n.length;e++){i.effect.push(_e[n[e]]),Xe[n[e]](i,o),void 0!==We[n[e]]&&i.simulate.push(We[n[e]]);for(let t in shared.effectConstraintsMap[n[e]]){const o=shared.effectConstraintsMap[n[e]][t];!0===o[2]&&(i[t]=Math.round(i[t])),i[t]<o[0]?i[t]=o[0]:i[t]>o[1]&&(i[t]=o[1])}}void 0!==o.sf&&i.simulate.push(o.sf),void 0!==o.ef&&(i.effect.push(o.ef),i.renderEffect.push(Ge[3])),void 0===o.sf&&void 0===o.ef||i.simulate.push((()=>{i.dimensions=Ee(i),i.topLeft=Ue(i)})),void 0!==o.cr&&(i.cr=o.cr),qe.push(i),void 0!==o.fixPoly&&("editor"===Se?(i.sat.setPoints(shared.fixPolygon(o.points).map((e=>new Ae.Vector(e[0],e[1])))),i.dimensions=Ee(i),i.topLeft=Ue(i)):(async()=>{await a.e(281).then(a.bind(a,281)),i.sat.setPoints(shared.fixPolygon(o.points).map((e=>new Ae.Vector(e[0],e[1])))),i.dimensions=Ee(i),i.topLeft=Ue(i)})())}Ae.Circle.prototype.rotate=function(e){this.pos.rotate(e)},shared.C=Te,shared.idToObs={},shared.tickFns=[];let Pe,Ie=new Ae.Response,ke=!1,Ce=new Ae.Vector,Re=new Ae.Vector;function Fe(e,t,n){let o,i,r,a,s,l=!1;return o=Math.atan2(t.pos.y-e.pos.y,t.pos.x-e.pos.x),o<0&&(o+=2*Math.PI),r=e.startSliceAngle<o,a=o<e.endSliceAngle,s=e.startSliceAngle>e.endSliceAngle,(!0===s?!0===r||!0===a:!0===r&&!0===a)&&(l=Ae.testCircleCircle(e.sat,t.sat,n),!0===l)?(i=(t.pos.y-e.pos.y)**2+(t.pos.x-e.pos.x)**2,i>((e.innerRadius+e.sat.r+t.sat.r)/2)**2||(i<=(e.innerRadius-t.sat.r)**2?(n.clear(),n.overlapN.x=n.overlapN.y=0,n.overlapV.x=n.overlapV.y=0,!1):(n.overlapN=n.overlapN.scale(-1,-1),n.overlap=e.sat.r-e.innerRadius+2*t.sat.r-n.overlap,n.overlapV=new Ae.Vector(n.overlapN.x*n.overlap,n.overlapN.y*n.overlap),!0))):!(Math.abs((e.startSliceAngle-e.endSliceAngle)%(2*Math.PI))<.001)&&(Ce.x=Ce.y=0,Re.x=Re.y=0,!0===Ae.testPolygonCircle(e.startSlice,t.sat,n)&&(l=!0,Ce.x+=n.overlapN.x,Ce.y+=n.overlapN.y,Re.x+=n.overlapV.x,Re.y+=n.overlapV.y,n.clear(),n.overlapN.x=n.overlapN.y=0,n.overlapV.x=n.overlapV.y=0),l||=Ae.testPolygonCircle(e.endSlice,t.sat,n),n.overlapN.x+=Ce.x,n.overlapN.y+=Ce.y,n.overlapN=n.overlapN.normalize(),n.overlapV.x+=Re.x,n.overlapV.y+=Re.y,n.overlap=n.overlapV.x/n.overlapN.x,l)}const De=[Ae.testCircleCircle,Ae.testCirclePolygon,Ae.testPolygonCircle,Ae.testPolygonPolygon];shared.collide=(e,t)=>(Ie.hasCollided=De[2*(void 0===e.sat.r)+(void 0===t.sat.r)](e.sat,t.sat,Ie),Ie),shared.boundAB=(e,t)=>{const n=shared.collide(e,t);!0===n.hasCollided&&(e.pos.x-=n.overlapV.x,e.pos.y-=n.overlapV.y),n.clear()},shared.isABColliding=(e,t)=>{if(void 0===e||void 0===t)return!1;const n=shared.collide(e,t),o=n.hasCollided;return n.clear(),o};const Le=[e=>new Ae.Circle(new Ae.Vector(e.x,e.y),e.r),e=>new Ae.Box(new Ae.Vector(e.x,e.y),e.w,e.h).toPolygon(),e=>{e.points.length<2&&(e.points=shared.satDefaultMap[2].points),e.x=0,e.y=0;const t=new Ae.Polygon(new Ae.Vector,e.points.map((e=>new Ae.Vector(e[0],e[1]))));return t.pos.x=e.x,t.pos.y=e.y,t},e=>{if(!0===shared.isServer)return new Ae.Box(new Ae.Vector(e.x,e.y),100,100).toPolygon();ctx.textAlign="center",ctx.textBaseline="middle",ctx.font=`${e.fontSize}px Inter`;const t=ctx.measureText(e.text),n=t.actualBoundingBoxRight+t.actualBoundingBoxLeft,o=t.actualBoundingBoxDescent+t.actualBoundingBoxAscent;return new Ae.Box(new Ae.Vector(e.x-n/2,e.y-o/2),n,o).toPolygon()},e=>{const t=new Ae.Circle(new Ae.Vector(e.x,e.y),e.r),n=e;return n.startSliceAngle%=2*Math.PI,n.endSliceAngle%=2*Math.PI,n.startSliceAngle<0&&(n.startSliceAngle+=2*Math.PI),n.endSliceAngle<0&&(n.endSliceAngle+=2*Math.PI),n.startSlice=new Ae.Polygon(new Ae.Vector,[new Ae.Vector(Math.cos(n.startSliceAngle)*n.r,Math.sin(n.startSliceAngle)*n.r),new Ae.Vector(Math.cos(n.startSliceAngle)*n.innerRadius,Math.sin(n.startSliceAngle)*n.innerRadius)]),n.endSlice=new Ae.Polygon(new Ae.Vector,[new Ae.Vector(Math.cos(n.endSliceAngle)*n.r,Math.sin(n.endSliceAngle)*n.r),new Ae.Vector(Math.cos(n.endSliceAngle)*n.innerRadius,Math.sin(n.endSliceAngle)*n.innerRadius)]),n.startSlice.pos=n.endSlice.pos=t.pos,0===e.startSliceAngleRotateSpeed&&0===e.endSliceAngleRotateSpeed||(e.circleSliceRotate=e=>{e.startSliceAngle+=e.startSliceAngleRotateSpeed,e.endSliceAngle+=e.endSliceAngleRotateSpeed,e.startSliceAngle%=2*Math.PI,e.endSliceAngle%=2*Math.PI,e.startSliceAngle<0&&(e.startSliceAngle+=2*Math.PI),e.endSliceAngle<0&&(e.endSliceAngle+=2*Math.PI),e.startSlice.setPoints([new Ae.Vector(Math.cos(e.startSliceAngle)*e.sat.r,Math.sin(e.startSliceAngle)*e.sat.r),new Ae.Vector(Math.cos(e.startSliceAngle)*e.innerRadius,Math.sin(e.startSliceAngle)*e.innerRadius)]),e.endSlice.setPoints([new Ae.Vector(Math.cos(e.endSliceAngle)*e.sat.r,Math.sin(e.endSliceAngle)*e.sat.r),new Ae.Vector(Math.cos(e.endSliceAngle)*e.innerRadius,Math.sin(e.endSliceAngle)*e.innerRadius)]),e.startSlice.pos=e.endSlice.pos=e.sat.pos}),t}];function Oe(){const e=shared.obstacles;for(let t=0;t<e.length;t++){if(!0!==e[t].isText)continue;const n=e[t].dimensions;e[t].dimensions=Ee(e[t]),e[t].pos.x+=(n.x-e[t].dimensions.x)/2,e[t].pos.y+=(n.y-e[t].dimensions.y)/2,e[t].topLeft=Ue(e[t])}}function Ee(e){const t=e.sat;if(void 0!==t.r)return{x:2*t.r,y:2*t.r};let n,o,i,r;i=o=-1/0,n=r=1/0;for(let e of t.points)e.x<r&&(r=e.x),e.x>o&&(o=e.x),e.y>i&&(i=e.y),e.y<n&&(n=e.y);return{x:o-r,y:i-n}}function Ue(e){let t=e.pos.x,n=e.pos.y;if(void 0!==e.sat.r)t-=e.sat.r,n-=e.sat.r;else{let o=1/0,i=1/0;for(let t=0;t<e.sat.points.length;t++)e.sat.points[t].x<o&&(o=e.sat.points[t].x),e.sat.points[t].y<i&&(i=e.sat.points[t].y);t+=o,n+=i}return{x:t,y:n}}setTimeout(Oe,1e3),setTimeout(Oe,3e3),shared.generateDimensions=Ee,shared.generateTopLeftCoordinates=Ue,shared.satMapI2N=["circle","rectangle","polygon","text","circleSlice"],shared.satConstraintsMap=[void 0,void 0,void 0,{fontSize:[1]},void 0],shared.satDefaultMap=[{x:450,y:800,r:120},{x:300,y:700,w:300,h:200},{points:[[300,700],[600,700],[450,900]]},{x:450,y:800,text:["Why hello there","I am a text :D","Evades X","Taste the Edge."][Math.floor(4*Math.random())],fontSize:80},{x:450,y:800,r:120,innerRadius:80,startSliceAngle:0,endSliceAngle:0,startSliceAngleRotateSpeed:0,endSliceAngleRotateSpeed:0}];const ze=2*Math.PI,Be=[e=>{ctx.arc(e.pos.x,e.pos.y,e.sat.r,0,ze)},e=>{void 0===e.rotation?ctx.rect(e.pos.x,e.pos.y,e.dimensions.x,e.dimensions.y):Be[2](e)},e=>{for(let t=0;t<e.sat.points.length;t++)ctx.lineTo(e.pos.x+e.sat.points[t].x,e.pos.y+e.sat.points[t].y);ctx.lineTo(e.pos.x+e.sat.points[0].x,e.pos.y+e.sat.points[0].y)},e=>{Be[1](e)},e=>{ctx.moveTo(e.pos.x+Math.cos(e.startSliceAngle)*e.innerRadius,e.pos.y+Math.sin(e.startSliceAngle)*e.innerRadius),ctx.lineTo(e.pos.x+Math.cos(e.startSliceAngle)*e.sat.r,e.pos.y+Math.sin(e.startSliceAngle)*e.sat.r),ctx.arc(e.pos.x,e.pos.y,e.sat.r,e.startSliceAngle,e.endSliceAngle),ctx.lineTo(e.pos.x+Math.cos(e.endSliceAngle)*e.innerRadius,e.pos.y+Math.sin(e.endSliceAngle)*e.innerRadius),0!==e.innerRadius&&ctx.arc(e.pos.x,e.pos.y,e.innerRadius,e.endSliceAngle,e.startSliceAngle,!0)}],Ne=[(e,t)=>{e.path=t.path;for(let t=e.path.length-1;t>=1;t--)e.path[t][0]===e.path[t-1][0]&&e.path[t][1]===e.path[t-1][1]&&e.path.splice(t,1);e.path.length<2&&(e.path=shared.simulateDefaultMap[0].path),e.currentPoint=Math.floor(t.currentPoint)%e.path.length,e.pointOn=e.path[e.currentPoint],e.speed=e.pointOn[2];let n=e.currentPoint+1;n===e.path.length&&(n=0),e.pointTo=e.path[n],Pe=Math.atan2(e.pointTo[1]-e.pointOn[1],e.pointTo[0]-e.pointOn[0]),e.xv=Math.cos(Pe)*e.speed,e.yv=Math.sin(Pe)*e.speed,e.timeRemain=Math.sqrt((e.pointOn[0]-e.pointTo[0])**2+(e.pointOn[1]-e.pointTo[1])**2)/e.speed;const o=t.currentPoint-Math.floor(t.currentPoint);if(0!==o){const t=e.timeRemain*(1-o),n=e.timeRemain-t;e.pos.x+=n*e.xv,e.pos.y+=n*e.yv,e.timeRemain=t}e.pos.x+=e.pointOn[0]-e.path[0][0],e.pos.y+=e.pointOn[1]-e.path[0][1]},(e,t)=>{e.pivotX=t.pivotX,e.pivotY=t.pivotY,e.rotation=0,0!==t.initialRotation&&void 0!==t.initialRotation&&(e.rotateSpeed=t.initialRotation,Ve[1](e)),e.rotateSpeed=t.rotateSpeed},(e,t)=>{e.growSpeed=t.growSpeed,e.shrinkSpeed=t.shrinkSpeed,e.maxGrowth=t.maxGrowth,e.minGrowth=t.minGrowth,e.growing=t.toStartGrowing,e.growth=e.lastGrowth=t.startGrowth},()=>{},(e,t)=>{let n=t.id.toString().trim();void 0!==shared.idToObs[n]&&"editor"===Se&&alert(`Warning! Duplicate id "${n}" found! Duplicate ids override each other.`),shared.idToObs[n]=e},(e,t)=>{e.toRest=t.toRest,e.restAngles=t.restAngles,e.homingRotateSpeed=t.homingRotateSpeed,e.rotation=0,e.detectionRadiusSquared=t.detectionRadius**2,e.spokeAngles=t.spokeAngles,e.pivotX=t.pivotX,e.pivotY=t.pivotY}],Ve=[e=>{if(e.pos.x+=e.xv,e.pos.y+=e.yv,e.timeRemain--,e.timeRemain<=0){e.currentPoint++,e.currentPoint===e.path.length&&(e.currentPoint=0),e.pointOn=e.path[e.currentPoint],e.speed=e.pointOn[2],e.pos.x+=e.xv*e.timeRemain,e.pos.y+=e.yv*e.timeRemain;let t=e.currentPoint+1;t===e.path.length&&(t=0),e.pointTo=e.path[t],Pe=Math.atan2(e.pointTo[1]-e.pointOn[1],e.pointTo[0]-e.pointOn[0]),e.xv=Math.cos(Pe)*e.speed,e.yv=Math.sin(Pe)*e.speed;let n=Math.sqrt((e.pointOn[0]-e.xv*e.timeRemain-e.pointTo[0])**2+(e.pointOn[1]-e.yv*e.timeRemain-e.pointTo[1])**2);(e.xv**2+e.yv**2)*e.timeRemain**2>n?n=Math.sqrt((e.pointOn[0]-e.pointTo[0])**2+(e.pointOn[1]-e.pointTo[1])**2):(e.pos.x-=e.xv*e.timeRemain,e.pos.y-=e.yv*e.timeRemain),e.timeRemain=n/e.speed}e.topLeft=shared.generateTopLeftCoordinates(e)},e=>{void 0!==e.sat.r?(e.pos.x-=e.pivotX,e.pos.y-=e.pivotY,e.sat.rotate(e.rotateSpeed),e.pos.x+=e.pivotX,e.pos.y+=e.pivotY):(e.sat.translate(e.pos.x-e.pivotX,e.pos.y-e.pivotY),e.sat.rotate(e.rotateSpeed),e.sat.translate(e.pivotX-e.pos.x,e.pivotY-e.pos.y)),e.rotation+=e.rotateSpeed,e.dimensions=Ee(e),e.topLeft=shared.generateTopLeftCoordinates(e)},e=>{!0===e.growing?(e.growth+=e.growSpeed,e.growth>=e.maxGrowth&&(e.growing=!1,e.growth=e.maxGrowth)):(e.growth-=e.shrinkSpeed,e.growth<=e.minGrowth&&(e.growing=!0,e.growth=e.minGrowth));const t=e.growth/e.lastGrowth;if(void 0!==e.sat.r)e.sat.r*=t;else{let n=e.topLeft.x+e.dimensions.x/2,o=e.topLeft.y+e.dimensions.y/2;for(let i=0;i<e.sat.points.length;i++)e.sat.points[i].x=(e.sat.points[i].x+e.pos.x-n)*t-e.pos.x+n,e.sat.points[i].y=(e.sat.points[i].y+e.pos.y-o)*t-e.pos.y+o;e.sat.setPoints(e.sat.points),!0===e.isText&&(e.fontSize*=t)}e.topLeft=shared.generateTopLeftCoordinates(e),e.dimensions=Ee(e),e.lastGrowth=e.growth},()=>{},()=>{},(e,t)=>{let n=e.topLeft.x+e.dimensions.x/2,o=e.topLeft.y+e.dimensions.y/2;if(!0===t.dead||(t.pos.x-n)**2+(t.pos.y-o)**2>e.detectionRadiusSquared){if(!1===e.toRest)return;let t=1/0;for(let n=0;n<e.restAngles.length;n++){let o=je(e.rotation,e.restAngles[n]);Math.abs(o)<Math.abs(t)&&(t=o)}if(t===1/0)return;return Math.abs(t)<e.homingRotateSpeed?e.rotateSpeed=t:e.rotateSpeed=Math.sign(t)*e.homingRotateSpeed,void Ve[1](e)}Pe=Math.atan2(t.pos.y-o,t.pos.x-n);let i=1/0;for(let t=0;t<e.spokeAngles.length;t++){let n=je(e.spokeAngles[t]+e.rotation,Pe);Math.abs(n)<Math.abs(i)&&(i=n)}i!==1/0&&(Math.abs(i)<e.homingRotateSpeed?e.rotateSpeed=i:e.rotateSpeed=Math.sign(i)*e.homingRotateSpeed,Ve[1](e))}];function je(e,t){let n=(t-e)%ze;return 2*n%ze-n}shared.simulateMapI2N=["pathMove","rotate","grow","custom","id","rotateHoming"],shared.simulateDefaultMap=[{currentPoint:0,path:[[0,0,1],[100,0,2],[0,100,3]]},{initialRotation:0,rotateSpeed:.01,pivotX:450,pivotY:800},{growSpeed:.006,shrinkSpeed:.006,maxGrowth:1.25,minGrowth:1,startGrowth:1,toStartGrowing:!0},{},{id:"uniqueId"},{toRest:!0,restAngles:[0,Math.PI],homingRotateSpeed:.01,detectionRadius:200,spokeAngles:[0,Math.PI],pivotX:450,pivotY:800}],shared.simulateConstraintsMap=[{currentPoint:[0]},void 0,{growSpeed:[0],shrinkSpeed:[0],minGrowth:[.001],maxGrowth:[.001]},void 0,void 0];const Xe=[()=>{},(e,t)=>{e.boundPlayer=t.boundPlayer??!1},(e,t)=>{e.bounciness=t.bounciness,e.decay=t.decay},()=>{},(e,t)=>{e.img="undefined"==typeof Image?{}:new Image,e.img.src=t.url,e.imgLoaded=!1,e.img.onload=()=>{e.imgLoaded=!0}},()=>{},(e,t)=>{e.isWinpad=!0},(e,t)=>{e.collected=!1,e.coinAmount=t.coinAmount,e.color=t.color},(e,t)=>{e.isCoindoor=!0,e.maxCoins=e.coins=t.coindoorCoinAmount,e.coinDoorColor=t.coinDoorColor},(e,t)=>{e.checkpointCollected=!1,e.checkpointOffsetX=t.checkpointOffsetX,e.checkpointOffsetY=t.checkpointOffsetY},(e,t)=>{e.maxStrength=t.maxStrength,e.strength=e.maxStrength,e.regenTime=t.regenTime,e.lastBrokeTime=-1e99,e.healSpeed=t.healSpeed},()=>{},(e,t)=>{e.tpx=t.tpx,e.tpy=t.tpy},(e,t)=>{e.conveyorForce=t.conveyorForce,e.conveyorAngle=t.conveyorAngle*Math.PI/180,e.conveyorAngleRotateSpeed=t.conveyorAngleRotateSpeed*Math.PI/180,e.conveyorFriction=t.conveyorFriction},(e,t)=>{e.platformerForce=t.platformerForce,e.platformerAngle=t.platformerAngle*Math.PI/180,e.platformerAngleRotateSpeed=t.platformerAngleRotateSpeed*Math.PI/180,e.platformerFriction=t.platformerFriction,e.maxJumpCooldown=t.maxJumpCooldown,e.jumpCooldown=0,e.jumpForce=t.jumpForce,e.jumpFriction=t.jumpDecay,e.canJumpMidair=t.canJumpMidair,e.midairStoredJump=!1,e.justJumped=!1,e.jumpForceObj={playerForceId:void 0},e.touchingPlatformer=!1},(e,t)=>{e.axisSpeedMultX=t.axisSpeedMultX,e.axisSpeedMultY=t.axisSpeedMultY},(e,t)=>{e.toSnapX=t.toSnapX,e.toSnapY=t.toSnapY,e.snapDistanceX=t.snapDistanceX,e.snapDistanceY=t.snapDistanceY,e.snapCooldown=e.maxSnapCooldown=t.snapCooldown,e.snapAngle=t.snapAngle*Math.PI/180,e.snapAngleRotateSpeed=t.snapAngleRotateSpeed*Math.PI/180,e.interpolatePlayerData={time:0,nextX:-1,nextY:-1},e.snapMagnitude=Math.sqrt(e.snapDistanceX**2+e.snapDistanceY**2)},(e,t)=>{e.timeTrapTime=e.timeTrapMaxTime=t.timeTrapMaxTime,e.timeTrapRecoverySpeed=t.timeTrapRecoverySpeed,e.timeTrapToKill=t.timeTrapToKill,e.timeTrapToShowTenth=t.timeTrapToShowTenth,e.timeTrapIntersecting=!1},(e,t)=>{e.sizeMult=t.sizeMult,e.sizeChangePermanent=t.sizeChangePermanent,e.lastChangeSizeColliding=e.changeSizeColliding=!1},(e,t)=>{e.speedMult=t.speedMult,e.speedChangePermanent=t.speedChangePermanent},(e,t)=>{e.hex=t.hex,e.alpha=t.alpha},(e,t)=>{e.decoFilePath=t.decoFilePath},(e,t)=>{e.mapName=t.mapName,e.difficulty=shared.mapDifficulties[t.mapName]??0},(e,t)=>{e.tornadoStrength=t.tornadoStrength},(e,t)=>{e.innerR=t.innerR,e.innerG=t.innerG,e.innerB=t.innerB,e.innerSize=t.innerSize,e.innerOpacity=t.innerOpacity,e.outerR=t.outerR,e.outerG=t.outerG,e.outerB=t.outerB,e.outerSize=t.outerSize,e.outerOpacity=t.outerOpacity},(e,t)=>{e.lastPushAngle=e.pushAngle=t.pushAngle*Math.PI/180,e.maxPushDistance=t.maxPushDistance,e.idlePushBackSpeed=t.idlePushBackSpeed,e.pushConversionRatio=t.pushConversionRatio,e.positiveDirectionOnly=t.positiveDirectionOnly,e.pushAngleVecX=Math.cos(e.pushAngle),e.pushAngleVecY=Math.sin(e.pushAngle),e.pushPercent=0},(e,t)=>{e.musicPath=t.musicPath,e.musicStartTime=t.musicStartTime},(e,t)=>{e.changeShipStateTo=t.changeShipStateTo,e.initialShipAngle=t.initialShipAngle,e.shipTurnSpeed=t.shipTurnSpeed},(e,t)=>{e.changeGrappleStateTo=t.changeGrappleStateTo,e.grappleRange=t.grappleRange,e.grappleForce=t.grappleForce,e.grappleFric=t.grappleFric},(e,t)=>{e.changeDeathTimerStateTo=t.changeDeathTimerStateTo,e.drainAmountWhileStandingOn=t.drainAmountWhileStandingOn,e.deathTime=t.deathTime;for(let t in shared.effectDefaultMap[24])e[t]=shared.effectDefaultMap[24][t];e.innerR=e.outerR=255}];let Ye=-1;const _e=[(e,t,n,o)=>{e.pos.x+=t.overlapV.x,e.pos.y+=t.overlapV.y,e.touchingNormalIndexes.push(o)},(e,t,n)=>{t.overlap>1&&(e.dead=!0,!0===n.boundPlayer&&(e.pos.x+=t.overlapV.x,e.pos.y+=t.overlapV.y))},(e,t,n)=>{e.pos.x+=t.overlapV.x,e.pos.y+=t.overlapV.y,Pe=Math.atan2(t.overlapV.y,t.overlapV.x),e.forces.push(Math.cos(Pe)*n.bounciness,Math.sin(Pe)*n.bounciness,n.decay)},()=>{},()=>{},e=>{e.stopForces=!0},(e,t,n)=>{"editor"===Se||!0===shared.standalone?(shared.respawnPlayer(),!0===shared.inClearCheckMode&&(shared.exitClearCheckMode(),uploadCode())):!0!==shared.won&&(shared.won=!0,!0===shared.isExClient?"/maps/winroom"===shared.mapPath?shared.changeMap("/maps/hub"):shared.changeMap("/maps/winroom"):(Me=!0,!0===shared.tutorial&&shared.beatCurrentTutorialMap()))},(e,t,n)=>{if(!0!==n.collected){n.collected=!0;for(let e=0;e<qe.length;e++)!0===qe[e].isCoindoor&&qe[e].coinDoorColor===n.color&&(qe[e].coins-=n.coinAmount)}},(e,t,n)=>{n.coins>0&&(e.pos.x+=t.overlapV.x,e.pos.y+=t.overlapV.y)},(e,t,n)=>{!0!==n.checkpointCollected&&(n.checkpointCollected=!0,shared.spawnPosition.x=n.topLeft.x+n.dimensions.x/2,shared.spawnPosition.y=n.topLeft.y+n.dimensions.y/2)},(e,t,n,o)=>{n.strength>0&&(e.pos.x+=t.overlapV.x,e.pos.y+=t.overlapV.y,n.strength--,n.strength<0&&(n.strength=0),e.touchingNormalIndexes.push(o)),n.lastBrokeTime=window.frames},(e,t,n)=>{e.onSafe=!0},(e,t,n)=>{e.pos.x=n.tpx,e.pos.y=n.tpy,e.renderRadius=Math.min(e.renderRadius,e.sat.r/2)},(e,t,n)=>{e.forces.push(Math.cos(n.conveyorAngle)*n.conveyorForce,Math.sin(n.conveyorAngle)*n.conveyorForce,n.conveyorFriction)},(e,t,n,o)=>{n.touchingPlatformer=!0,n.jumpCooldown--,e.forces.push(Math.cos(n.platformerAngle)*n.platformerForce,Math.sin(n.platformerAngle)*n.platformerForce,n.platformerFriction);const i=Math.atan2(e.yv,e.xv),r=n.platformerAngle-i,a=Math.cos(r)*Math.sqrt(e.yv**2+e.xv**2)/e.friction;e.pos.x-=Math.cos(n.platformerAngle)*a,e.pos.y-=Math.sin(n.platformerAngle)*a;const s=0!==e.touchingNormalIndexes.length||e.lastTouchingNormalIndexes[e.lastTouchingNormalIndexes.length-1]>=o&&!1===n.justJumped||!0===e.touchingWall;n.justJumped=!1,n.jumpCooldown<=0&&(!0===s||!0===n.canJumpMidair&&!0===n.midairStoredJump)?(n.midairStoredJump=n.midairStoredJump||s,n.canJump=!0,Math.abs(je(n.platformerAngle+Math.PI,i))<.48*Math.PI&&-Math.sqrt(e.xv**2+e.yv**2)*Math.cos(r)>.1&&(e.forces.push(-Math.cos(n.platformerAngle)*n.jumpForce,-Math.sin(n.platformerAngle)*n.jumpForce,n.jumpFriction),n.jumpCooldown=n.maxJumpCooldown,n.midairStoredJump=!1,n.justJumped=!0)):n.canJump=!1},(e,t,n)=>{e.axisSpeedMultX*=n.axisSpeedMultX,e.axisSpeedMultY*=n.axisSpeedMultY},(e,t,n)=>{if(n.snapCooldown--,n.snapCooldown<=0&&(!0===n.toSnapX&&Math.abs(e.xv)>.01||!0===n.toSnapY&&Math.abs(e.yv)>.01)){n.snapCooldown=n.maxSnapCooldown;let t=Math.atan2(!0===n.toSnapY?e.yv:0,!0===n.toSnapX?e.xv:0);n.interpolatePlayerData={time:Math.min(n.maxSnapCooldown-1,5),nextX:e.pos.x+Math.cos(t)*n.snapMagnitude*.95,nextY:e.pos.y+Math.sin(t)*n.snapMagnitude*.95}}if(n.interpolatePlayerData.time>1)n.interpolatePlayerData.time--,e.pos.x=.8*e.pos.x+.2*n.interpolatePlayerData.nextX,e.pos.y=.8*e.pos.y+.2*n.interpolatePlayerData.nextY;else{let t=n.topLeft.x+n.dimensions.x/2,o=n.topLeft.y+n.dimensions.y/2,i={angle:Math.atan2(e.pos.y-o,e.pos.x-t)-n.snapAngle,distance:Math.sqrt((e.pos.y-o)**2+(e.pos.x-t)**2)};i.x=Math.cos(i.angle)*i.distance,i.y=Math.sin(i.angle)*i.distance,!0===n.toSnapX&&(i.x=.4*i.x+Math.round(i.x/n.snapDistanceX)*n.snapDistanceX*.6),!0===n.toSnapY&&(i.y=.4*i.y+Math.round(i.y/n.snapDistanceY)*n.snapDistanceY*.6),i.angle=Math.atan2(i.y,i.x)+n.snapAngle,i.distance=Math.sqrt(i.y**2+i.x**2),e.pos.x=Math.cos(i.angle)*i.distance+t,e.pos.y=Math.sin(i.angle)*i.distance+o}},(e,t,n)=>{n.timeTrapIntersecting=!0,n.timeTrapTime--,n.timeTrapTime<0&&(!0===n.timeTrapToKill&&(e.dead=e.timeTrapOverrideSafe=!0),n.timeTrapTime=0)},(e,t,n)=>{n.sizeMult<1&&!1===n.lastChangeSizeColliding&&(t.clear(),e.sat.r*=n.sizeMult,ke=void 0!==n.sat.r?Ae.testCircleCircle(n.sat,e.sat,t):Ae.testPolygonCircle(n.sat,e.sat,t),e.sat.r/=n.sizeMult,!1===ke)||(!0===n.sizeChangePermanent&&void 0===n.permanentSizeChangeDone&&(n.permanentSizeChangeDone=!0,e.sat.r*=n.sizeMult),n.changeSizeColliding=!0)},(e,t,n)=>{!0===n.speedChangePermanent?void 0===n.permanentSpeedChangeDone&&(n.permanentSpeedChangeDone=!0,e.speed*=n.speedMult):(e.axisSpeedMultX*=n.speedMult,e.axisSpeedMultY*=n.speedMult)},(e,t,n)=>{},(e,t,n)=>{},(e,t,n)=>{!0!==shared.won&&(shared.won=!0,!0===shared.isExClient&&shared.changeMap("/maps/"+n.mapName))},(e,t,n)=>{e.pos.x+=Math.cos(360*Math.random())*n.tornadoStrength,e.pos.y+=Math.sin(360*Math.random())*n.tornadoStrength},(e,t,n)=>{const o=shared.colors.vignette;o.inner.r=n.innerR,o.inner.g=n.innerG,o.inner.b=n.innerB,o.inner.size=n.innerSize,o.inner.opacity=n.innerOpacity,o.outer.r=n.outerR,o.outer.g=n.outerG,o.outer.b=n.outerB,o.outer.size=n.outerSize,o.outer.opacity=n.outerOpacity},(e,t,n)=>{n.pushAngle!==n.lastPushAngle&&(n.lastPushAngle=n.pushAngle,n.pushAngleVecX=Math.cos(n.pushAngle),n.pushAngleVecY=Math.sin(n.pushAngle)),Ye=-(n.pushAngleVecX*t.overlapV.x+n.pushAngleVecY*t.overlapV.y)*n.pushConversionRatio,(!1===n.positiveDirectionOnly||Ye>0)&&(n.pushPercent+=Ye/n.maxPushDistance,n.pushPercent>1?(Ye-=(n.pushPercent-1)*n.maxPushDistance,n.pushPercent=1):n.pushPercent<0&&(Ye-=n.pushPercent*n.maxPushDistance,n.pushPercent=0),n.pos.x+=n.pushAngleVecX*Ye,n.pos.y+=n.pushAngleVecY*Ye),t.clear(),ke=void 0!==n.sat.r?Ae.testCircleCircle(n.sat,e.sat,t):Ae.testPolygonCircle(n.sat,e.sat,t),!0===ke&&(e.pos.x+=t.overlapV.x,e.pos.y+=t.overlapV.y)},(e,t,n)=>{shared.playMusic(n.musicPath,n.musicStartTime)},(e,t,n)=>{e.ship!==n.changeShipStateTo&&(!0===shared.isExClient&&!1===n.changeShipStateTo&&(shared.u4[0]=10,send(shared.u4)),!1===e.ship&&!0===n.changeShipStateTo&&(e.shipAngle=n.initialShipAngle,e.shipTurnSpeed=n.shipTurnSpeed),e.ship=n.changeShipStateTo)},(e,t,n)=>{!0===e.grapple&&!1===n.changeGrappleStateTo&&(!0===shared.isExClient&&(shared.u4[0]=12,send(shared.u4)),e.grappleX=e.grappleY=-1),e.grapple=n.changeGrappleStateTo,e.grappleRange=n.grappleRange,e.grappleForce=n.grappleForce,e.grappleFric=n.grappleFric},(e,t,n)=>{!0===shared.isExClient&&!0===e.deathTimer&&!1===n.changeDeathTimerStateTo&&(shared.u4[0]=14,send(shared.u4)),!0===n.changeDeathTimerStateTo&&(!1===e.deathTimer?e.deathTime=n.deathTime:e.deathTime=Math.min(e.deathTime,n.deathTime),e.deathTime-=n.drainAmountWhileStandingOn,_e[24](e,t,n)),e.deathTimer=n.changeDeathTimerStateTo}],We=[void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,e=>{e.strength<e.maxStrength&&window.frames-e.lastBrokeTime>e.regenTime&&(e.strength+=e.healSpeed,e.strength>=e.maxStrength&&(e.lastBrokeTime=window.frames,e.strength=e.maxStrength))},void 0,void 0,e=>{e.conveyorAngle+=e.conveyorAngleRotateSpeed},e=>{e.platformerAngle+=e.platformerAngleRotateSpeed},void 0,e=>{e.snapAngle+=e.snapAngleRotateSpeed},e=>{!0!==e.timeTrapIntersecting&&(e.timeTrapTime+=e.timeTrapRecoverySpeed),e.timeTrapTime>e.timeTrapMaxTime&&(e.timeTrapTime=e.timeTrapMaxTime),e.timeTrapIntersecting=!1},(e,t)=>{!0!==e.sizeChangePermanent&&(!0===e.lastChangeSizeColliding&&!1===e.changeSizeColliding?t.sat.r/=e.sizeMult:!1===e.lastChangeSizeColliding&&!0===e.changeSizeColliding&&(t.sat.r*=e.sizeMult),e.lastChangeSizeColliding=e.changeSizeColliding,e.changeSizeColliding=!1)},void 0,void 0,void 0,void 0,void 0,void 0,(e,t)=>{Ye=-e.idlePushBackSpeed,e.pushPercent+=Ye/e.maxPushDistance,e.pushPercent>1?(Ye-=(e.pushPercent-1)*e.maxPushDistance,e.pushPercent=1):e.pushPercent<0&&(Ye-=e.pushPercent*e.maxPushDistance,e.pushPercent=0),e.pos.x+=Ye*Math.cos(e.pushAngle),e.pos.y+=Ye*Math.sin(e.pushAngle)},void 0,void 0,void 0,void 0];shared.effectConstraintsMap=[void 0,void 0,{decay:[void 0,1]},void 0,void 0,void 0,void 0,{coinAmount:[1]},{coins:[1],maxCoins:[1]},void 0,{maxStrength:[1],regenTime:[0],healSpeed:[0]},void 0,void 0,{conveyorFriction:[void 0,1]},{platformerFriction:[void 0,1],jumpFriction:[void 0,1]},void 0,{snapDistanceX:[.1],snapDistanceY:[.1],snapCooldown:[0]},{timeTrapTime:[0],timeTrapMaxTime:[0]},void 0,void 0,void 0,void 0,void 0,void 0,void 0,{maxPushDistance:[0]},void 0,void 0,void 0,void 0],shared.effectMapI2N=["bound","kill","bounce","custom","customImage","stopForces","winpad","coin","coindoor","checkpoint","breakable","safe","tp","conveyor","platformer","restrictAxis","snapGrid","timeTrap","changeSize","changeSpeed","solidColor","decoration","changeMap","tornado","changeVignette","pushable","changeMusic","changeShip","changeGrapple","changeDeathTimer"],shared.effectDefaultMap=[{},{boundPlayer:!1},{bounciness:1,decay:.98},{},{url:"http://tinyurl.com/dwayne-t-rj"},{},{},{coinAmount:1,color:"#d6d611"},{coindoorCoinAmount:3,coinDoorColor:"#d6d611"},{checkpointOffsetX:0,checkpointOffsetY:0},{maxStrength:60,regenTime:100,healSpeed:1},{},{tpx:100,tpy:100},{conveyorForce:.3,conveyorAngle:90,conveyorAngleRotateSpeed:0,conveyorFriction:.8},{platformerForce:1,platformerAngle:90,platformerAngleRotateSpeed:0,platformerFriction:.875,maxJumpCooldown:30,jumpForce:20,jumpDecay:.95},{axisSpeedMultX:0,axisSpeedMultY:1},{toSnapX:!0,toSnapY:!0,snapDistanceX:100,snapDistanceY:100,snapCooldown:40,snapAngle:0,snapAngleRotateSpeed:0},{timeTrapMaxTime:300,timeTrapRecoverySpeed:1.5,timeTrapToKill:!0,timeTrapToShowTenth:!1},{sizeMult:1.5,sizeChangePermanent:!1},{speedMult:2.5,speedChangePermanent:!1},{hex:"#FFFFFF",alpha:1},{},{mapName:"hub"},{tornadoStrength:1},{innerR:0,innerG:0,innerB:0,innerSize:.1,innerOpacity:0,outerR:0,outerG:0,outerB:0,outerSize:.5,outerOpacity:1},{pushAngle:180,maxPushDistance:100,idlePushBackSpeed:.25,positiveDirectionOnly:!1,pushConversionRatio:.8},{musicPath:"https://www.youtube.com/watch?v=OidXKRVVV70",musicStartTime:0},{changeShipStateTo:!0,initialShipAngle:0,shipTurnSpeed:Math.PI/100},{changeGrappleStateTo:!0,grappleRange:488,grappleForce:.01,grappleFric:.4},{changeDeathTimerStateTo:!0,drainAmountWhileStandingOn:0,deathTime:10}];const Ge=[e=>{ctx.fillStyle=shared.colors.tile},e=>{ctx.fillStyle=!0===e.boundPlayer?"#c70000":"#9e0000",ctx.strokeStyle="black",ctx.toStroke=!0,ctx.lineWidth=4},e=>{ctx.fillStyle="blue"},e=>{ctx.toFill=!1,ctx.cleanUpFunction=()=>{ctx.save(),ctx.clip(),ctx.drawImage(shared.starImg,e.topLeft.x,e.topLeft.y,e.dimensions.x,e.dimensions.y),ctx.restore()}},e=>{ctx.toFill=!1,!1!==e.imgLoaded&&(ctx.cleanUpFunction=()=>{ctx.save(),ctx.clip(),ctx.drawImage(e.img,e.topLeft.x,e.topLeft.y,e.dimensions.x,e.dimensions.y),ctx.restore()})},e=>{ctx.fillStyle="orange",ctx.strokeStyle="black",ctx.lineWidth=6,ctx.globalAlpha=.1,ctx.toStroke=!0},e=>{ctx.fillStyle=`hsl(${1e3*window.frames/60/12},50%,50%)`,ctx.shadowColor=ctx.fillStyle,ctx.shadowBlur=15,ctx.cleanUpFunction=()=>{ctx.shadowBlur=0}},e=>{ctx.fillStyle=e.color,!0===e.collected?ctx.globalAlpha=.2:ctx.globalAlpha=.8,1!==e.coinAmount&&(ctx.cleanUpFunction=()=>{let t=e.topLeft.x+e.dimensions.x/2,n=e.topLeft.y+e.dimensions.y/2;ctx.fillStyle=shared.colors.tile,ctx.font=`${Math.min(60,e.dimensions.x/4,e.dimensions.y/4)}px Inter`,ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText(Math.max(0,e.coinAmount),t,n)})},e=>{ctx.fillStyle=shared.colors.tile,ctx.globalAlpha=e.coins<=0?.5:1,ctx.cleanUpFunction=()=>{ctx.fillStyle=e.coinDoorColor;let t=e.topLeft.x+e.dimensions.x/2,n=e.topLeft.y+e.dimensions.y/2;ctx.beginPath(),ctx.roundRect(t-e.dimensions.x/4,n-e.dimensions.y/4,e.dimensions.x/2,e.dimensions.y/2,Math.min(e.dimensions.x,e.dimensions.y)/20),ctx.fill(),ctx.closePath(),ctx.fillStyle=shared.colors.tile,ctx.font=`${Math.min(60,e.dimensions.x/4,e.dimensions.y/4)}px Inter`,ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText(Math.max(0,e.coins),t,n)}},e=>{!0===e.checkpointCollected?(ctx.fillStyle="#0fba09",ctx.globalAlpha=.15):(ctx.fillStyle="#05962b",ctx.globalAlpha=.8)},e=>{ctx.fillStyle=shared.colors.tile,ctx.fillStyle=ve("#000000",ctx.fillStyle,.5),ctx.globalAlpha=e.strength/e.maxStrength},e=>{ctx.fillStyle="rgba(140,140,140,.25)",ctx.strokeStyle="black",ctx.lineWidth=4,ctx.toStroke=!0},e=>{ctx.fillStyle="#38ab30"},e=>{ctx.fillStyle=shared.colors.tile,ctx.globalAlpha=.1,ctx.cleanUpFunction=()=>{ctx.save(),ctx.clip(),ctx.globalAlpha=1;for(let t=e.topLeft.x+50;t<=e.topLeft.x+e.dimensions.x+50;t+=100)for(let n=e.topLeft.y+50;n<=e.topLeft.y+e.dimensions.y+50;n+=100)ctx.translate(t,n),ctx.rotate(e.conveyorAngle+Math.PI/2),ctx.drawImage(shared.arrowImg,-50,-50,100,100),ctx.rotate(-e.conveyorAngle-Math.PI/2),ctx.translate(-t,-n);ctx.restore()}},e=>{ctx.fillStyle=shared.colors.tile,ctx.globalAlpha=.1,ctx.cleanUpFunction=()=>{ctx.save(),ctx.clip();const t=1e3*window.frames/60*e.platformerForce*Math.cos(e.platformerAngle)/10%100-100,n=1e3*window.frames/60*e.platformerForce*Math.sin(e.platformerAngle)/10%100-100;ctx.globalAlpha=1;for(let o=e.topLeft.x+t+50;o<=e.topLeft.x+e.dimensions.x+50;o+=100)for(let t=e.topLeft.y+n+50;t<=e.topLeft.y+e.dimensions.y+50;t+=100)ctx.translate(o,t),ctx.rotate(e.platformerAngle+Math.PI/2),ctx.drawImage(shared.arrowImg,-50,-50,100,100),ctx.rotate(-e.platformerAngle-Math.PI/2),ctx.translate(-o,-t);if(ctx.restore(),!0===e.canJump&&!0===e.touchingPlatformer){const e=shared.players[shared.selfId];void 0!==e&&(ctx.globalAlpha=1,ctx.fillStyle="white",ctx.font="56px Inter",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText("",e.pos.x,e.pos.y-e.sat.r-50))}e.touchingPlatformer=!1}},e=>{e.axisSpeedMultX<0&&e.axisSpeedMultY<0?ctx.strokeStyle="red":e.axisSpeedMultX<0||e.axisSpeedMultY<0?ctx.strokeStyle="#ff6969":e.axisSpeedMultY>1||e.axisSpeedMultY>1?ctx.strokeStyle="#c5c500":ctx.strokeStyle="white",ctx.lineWidth=4,ctx.toFill=!1,ctx.toStroke=!0,ctx.cleanUpFunction=()=>{ctx.lineWidth=3,ctx.save(),ctx.translate(e.topLeft.x+e.dimensions.x/2,e.topLeft.y+e.dimensions.y/2),ctx.clip(),ctx.globalAlpha=e.axisSpeedMultX>1?.8:Math.max(.3,e.axisSpeedMultX<0?-e.axisSpeedMultX:1-e.axisSpeedMultX),ctx.strokeStyle=e.axisSpeedMultX<0?"red":e.axisSpeedMultX>1?"#c5c500":"white",ctx.beginPath();for(let t=-e.dimensions.x/2;t<=e.dimensions.x/2;t+=50)ctx.moveTo(t,-e.dimensions.y/2),ctx.lineTo(t,e.dimensions.y/2);ctx.stroke(),ctx.closePath(),ctx.globalAlpha=e.axisSpeedMultY>1?.8:Math.max(.3,e.axisSpeedMultY<0?-e.axisSpeedMultY:1-e.axisSpeedMultY),ctx.strokeStyle=e.axisSpeedMultY<0?"red":e.axisSpeedMultY>1?"#c5c500":"white",ctx.beginPath();for(let t=-e.dimensions.y/2;t<=e.dimensions.y/2;t+=50)ctx.moveTo(-e.dimensions.x/2,t),ctx.lineTo(e.dimensions.x/2,t);ctx.stroke(),ctx.closePath(),ctx.restore()}},e=>{ctx.fillStyle="#00008a",ctx.globalAlpha=.1,ctx.toClip=!0,ctx.cleanUpFunction=()=>{ctx.save(),ctx.clip(),ctx.strokeStyle=ve("#0f0000","#000000",Math.max(0,e.snapCooldown)/e.maxSnapCooldown),ctx.lineWidth=4,ctx.globalAlpha=.17;let t=e.topLeft.x+e.dimensions.x/2,n=e.topLeft.y+e.dimensions.y/2;ctx.translate(t,n),e.snapRotateMovementExpansion={base:Math.max(e.dimensions.x,e.dimensions.y)**2/Math.sqrt(e.dimensions.x**2+e.dimensions.y**2)},e.snapRotateMovementExpansion.x=Math.ceil(e.snapRotateMovementExpansion.base/e.snapDistanceX+1)*e.snapDistanceX,e.snapRotateMovementExpansion.y=Math.ceil(e.snapRotateMovementExpansion.base/e.snapDistanceY+1)*e.snapDistanceY,ctx.rotate(e.snapAngle);let o=new Path2D;if(!0===e.toSnapX)for(let t=-e.snapRotateMovementExpansion.x;t<=e.snapRotateMovementExpansion.x;t+=e.snapDistanceX)o.rect(-10+t,-e.snapRotateMovementExpansion.x-10,20,2*e.snapRotateMovementExpansion.x+20);if(!0===e.toSnapY)for(let t=-e.snapRotateMovementExpansion.y;t<=e.snapRotateMovementExpansion.y;t+=e.snapDistanceY)o.rect(-e.snapRotateMovementExpansion.y-10,-10+t,2*e.snapRotateMovementExpansion.y+20,20);ctx.stroke(o),ctx.closePath();const i=shared.players[shared.selfId];i.pos.x+e.snapMagnitude<t-e.dimensions.x/2||i.pos.x-e.snapMagnitude>t+e.dimensions.x/2||i.pos.y+e.snapMagnitude<n-e.dimensions.y/2||i.pos.y-e.snapMagnitude>n+e.dimensions.y/2||(ctx.strokeStyle="grey",ctx.fillStyle="black",ctx.globalAlpha=.2,ctx.beginPath(),ctx.clip(o),ctx.rotate(-e.snapAngle),ctx.translate(-t,-n),ctx.arc(i.pos.x,i.pos.y,e.snapMagnitude,0,2*Math.PI),ctx.stroke(),ctx.fill(),ctx.closePath()),ctx.restore()}},e=>{let t=e.topLeft.x+e.dimensions.x/2,n=e.topLeft.y+e.dimensions.y/2,o=ctx.createRadialGradient(t,n,0,t,n,Math.min(100,(e.dimensions.x+e.dimensions.y)/3));!1===e.timeTrapToKill?(o.addColorStop(0,"rgba(199,199,199,0)"),o.addColorStop(1,"rgba(199,199,199,1)")):(o.addColorStop(0,"rgba(199,0,0,0)"),o.addColorStop(1,"rgba(199,0,0,1)")),ctx.fillStyle=o,ctx.globalAlpha=Math.max(.12,.5-e.timeTrapTime/e.timeTrapMaxTime/2),ctx.cleanUpFunction=()=>{ctx.globalAlpha=Math.max(.3,e.timeTrapTime/e.timeTrapMaxTime/3),ctx.fillStyle="white",ctx.font=Math.min(e.dimensions.x,e.dimensions.y)/2+"px Inter",ctx.textAlign="center",ctx.textBaseline="middle",ctx.fillText(!0===e.timeTrapToShowTenth?Math.round(e.timeTrapTime/60*10)/10:Math.round(e.timeTrapTime/60),t,n)}},e=>{!0===e.sizeChangePermanent&&(ctx.toStroke=!0,ctx.lineWidth=10,ctx.lineDashOffset=1e3*-window.frames/60/15,e.sizeMult>1?ctx.strokeStyle="#0e30ad":ctx.strokeStyle="#1c1852",ctx.setLineDash([30,40]),ctx.cleanUpFunction=()=>{ctx.setLineDash([])}),!0===e.permanentSizeChangeDone?ctx.toFill=!1:e.sizeMult>1?ctx.fillStyle="#0e30ad":ctx.fillStyle="#1c1852",ctx.globalAlpha=.28},e=>{!0===e.speedChangePermanent&&(ctx.toStroke=!0,ctx.lineWidth=10,ctx.lineDashOffset=1e3*-window.frames/60/15,ctx.strokeStyle="#eba500",ctx.setLineDash([30,40]),ctx.cleanUpFunction=()=>{ctx.setLineDash([])}),!0===e.permanentSpeedChangeDone?ctx.toFill=!1:(ctx.fillStyle="#eba500",ctx.toStroke=!0,ctx.lineWidth=3,ctx.strokeStyle=ctx.fillStyle),ctx.globalAlpha=.25},e=>{ctx.fillStyle=e.hex,!0===e.isText?ctx.globalAlpha=0:ctx.globalAlpha=e.alpha},e=>{ctx.toFill=!1;const t=decorationImgs[e.decoFilePath];if(void 0===t){decorationImgs[e.decoFilePath]="loading";let t=new Image;return void("http"===e.decoFilePath.slice(0,4)?(t.src=e.decoFilePath,t.onload=()=>{decorationImgs[e.decoFilePath]=t}):"editor"===Se?a(796)(`./${e.decoFilePath}`).then((n=>{t.src=n.default,decorationImgs[e.decoFilePath]=t})):(t.src=`./gfx/decorations/${e.decoFilePath}`,t.onload=()=>{decorationImgs[e.decoFilePath]=t}))}if("loading"===t)return;let n=e.topLeft.x+e.dimensions.x/2,o=e.topLeft.y+e.dimensions.y/2;const i=Math.max(e.dimensions.x,e.dimensions.y);ctx.translate(n,o),void 0!==e.rotation&&ctx.rotate(e.rotation),ctx.drawImage(t,-i/2,-i/2,i,i),void 0!==e.rotation&&ctx.rotate(-e.rotation),ctx.translate(-n,-o)},e=>{let t=(1+Math.sin(1e3*window.frames/60/600))/2*(e.difficulty%1);ctx.fillStyle=ve($e[Math.floor(e.difficulty)],$e[Math.min(8,Math.ceil(e.difficulty))],t),ctx.cleanUpFunction=()=>{e.dimensions.x>e.dimensions.y?ctx.translate(e.dimensions.x-e.dimensions.y+e.topLeft.x,e.topLeft.y):ctx.translate(e.topLeft.x,e.dimensions.y-e.dimensions.x+e.topLeft.y),ctx.lineCap="round",ctx.globalAlpha=t,Je[Math.min(8,Math.ceil(e.difficulty))](Math.min(e.dimensions.x,e.dimensions.y)),ctx.globalAlpha=1-t,Je[Math.floor(e.difficulty)](Math.min(e.dimensions.x,e.dimensions.y)),ctx.lineCap="square",ctx.globalAlpha=1,e.dimensions.x>e.dimensions.y?ctx.translate(-(e.dimensions.x-e.dimensions.y+e.topLeft.x),-e.topLeft.y):ctx.translate(-e.topLeft.x,-(e.dimensions.y-e.dimensions.x+e.topLeft.y)),ctx.font=e.dimensions.x/3.5+"px Inter",ctx.fillStyle="white",ctx.textAlign="center",ctx.textBaseline="middle",ctx.globalAlpha=Math.min(1,(shared.players[shared.selfId].pos.y+canvas.h/2-e.topLeft.y)/e.dimensions.y),ctx.fillText(e.mapName.toUpperCase().replace("O","o"),e.topLeft.x+e.dimensions.x/2,e.topLeft.y-e.dimensions.y/4),ctx.globalAlpha=1}},e=>{ctx.fillStyle="#c0bbc9",ctx.globalAlpha=.25},e=>{ctx.toFill=!1},e=>{ctx.fillStyle=shared.colors.tile,ctx.cleanUpFunction=()=>{ctx.save(),ctx.clip(),ctx.strokeStyle="white",ctx.lineWidth=3,ctx.globalAlpha=.25,ctx.beginPath(),ctx.lineTo(e.topLeft.x,e.topLeft.y),ctx.lineTo(e.topLeft.x+e.dimensions.x,e.topLeft.y+e.dimensions.y),ctx.stroke(),ctx.beginPath(),ctx.lineTo(e.topLeft.x+e.dimensions.x,e.topLeft.y),ctx.lineTo(e.topLeft.x,e.topLeft.y+e.dimensions.y),ctx.stroke(),ctx.globalAlpha=1,ctx.lineWidth=3,ctx.restore()}},e=>{ctx.toFill=!1},e=>{ctx.fillStyle=!0===e.changeShipStateTo?"rgba(0,0,255,0.3)":"rgba(255,255,0,0.3)",ctx.strokeStyle=!0===e.changeShipStateTo?"blue":"yellow",ctx.lineDashOffset=1e3*-window.frames/60*150/1e3,ctx.lineWidth=4,ctx.setLineDash([30,30]),ctx.toStroke=!0,ctx.cleanUpFunction=()=>{ctx.setLineDash([])}},e=>{let t,n=e.topLeft.x+e.dimensions.x/2,o=e.topLeft.y+e.dimensions.y/2,i=ctx.createRadialGradient(n,o,0,n,o,Math.sqrt(e.dimensions.x**2+e.dimensions.y**2)/2);!0===e.changeGrappleStateTo?(t=1e3*window.frames/60/1600%.33,i.addColorStop(1,"rgba(127,127,255,0)"),i.addColorStop(.67+t,"rgba(127,127,255,1)"),i.addColorStop(.66+t,"rgba(127,127,255,0)"),i.addColorStop(.34+t,"rgba(127,127,255,1)"),i.addColorStop(.33+t,"rgba(127,127,255,0)"),i.addColorStop(.0101+t,"rgba(127,127,255,1)"),.01+t>0&&i.addColorStop(.01+t,"rgba(127,127,255,0)"),i.addColorStop(0,"rgba(127,127,255,1)")):(t=.33-1e3*window.frames/60/1600%.33,i.addColorStop(1,"rgba(255,255,127,0)"),i.addColorStop(.67+t,"rgba(255,255,127,1)"),i.addColorStop(.66+t,"rgba(255,255,127,0)"),i.addColorStop(.34+t,"rgba(255,255,127,1)"),i.addColorStop(.33+t,"rgba(255,255,127,0)"),i.addColorStop(.0101+t,"rgba(255,255,127,1)"),.01+t>0&&i.addColorStop(.01+t,"rgba(255,255,127,0)"),i.addColorStop(0,"rgba(255,255,127,1)")),ctx.fillStyle=i},e=>{if(void 0===shared.skullImg)return shared.skullImg=new Image,shared.skullImg.src="https://svgsilh.com/svg/1294357.svg",void(shared.skullImg.onload=()=>{shared.skullImgLoaded=!0});ctx.fillStyle=!0===e.changeDeathTimerStateTo?"red":"white",ctx.globalAlpha=.4,!1!==shared.skullImgLoaded&&(ctx.cleanUpFunction=()=>{ctx.globalAlpha=1;let t=e.topLeft.x+e.dimensions.x/2,n=e.topLeft.y+e.dimensions.y/2,o=Math.min(e.dimensions.x,e.dimensions.y);ctx.drawImage(shared.skullImg,t-o/2,n-o/2,o,o)})}],$e=shared.difficultyImageColors=["#6cd95b","#58ccb3","#0a77bf","#3528e0","#a142c9","#e32d8b","#fc5434","#fc3a3a","#c95d5d"],Je=shared.difficultyImageMap=[e=>{ctx.globalAlpha*=.3,ctx.strokeStyle="black",ctx.lineWidth=3*e/40,ctx.beginPath(),ctx.arc(e/2,e/2,e/4,0,2*Math.PI),ctx.stroke(),ctx.closePath()},e=>{ctx.strokeStyle="#288a75",ctx.lineWidth=3*e/40,ctx.beginPath(),ctx.arc(5*e/12,5*e/12,e/4,0,2*Math.PI),ctx.stroke(),ctx.closePath(),ctx.beginPath(),ctx.arc(7*e/12,7*e/12,e/4,0,2*Math.PI),ctx.stroke(),ctx.closePath()},e=>{ctx.globalAlpha*=.3,ctx.strokeStyle="black",ctx.lineWidth=3*e/40,ctx.strokeRect(e/4,e/4,e/2,e/2)},e=>{ctx.globalAlpha*=.3,ctx.strokeStyle="black",ctx.lineWidth=3*e/40,ctx.strokeRect(e/6,e/6,5*e/12,5*e/12),ctx.strokeRect(5*e/12,5*e/12,5*e/12,5*e/12)},e=>{ctx.globalAlpha*=.3,ctx.strokeStyle="black",ctx.lineWidth=3*e/40,ctx.beginPath(),ctx.lineTo(5*e/24,12*e/24),ctx.lineTo(12*e/24,19*e/24),ctx.lineTo(19*e/24,12*e/24),ctx.lineTo(12*e/24,5*e/24),ctx.lineTo(5*e/24,12*e/24),ctx.stroke(),ctx.closePath()},e=>{ctx.strokeStyle="#991d5d",ctx.lineWidth=3*e/40,ctx.beginPath(),ctx.lineTo(1*e/6,3*e/6),ctx.lineTo(3*e/6,5*e/6),ctx.lineTo(5*e/6,3*e/6),ctx.lineTo(3*e/6,1*e/6),ctx.lineTo(1*e/6,3*e/6),ctx.stroke(),ctx.closePath(),ctx.strokeRect(5*e/24,5*e/24,14*e/24,14*e/24)},e=>{ctx.fillStyle="#d94a2e",ctx.fillRect(0,80*e/120,120*e/120,40*e/120),ctx.fillRect(40*e/120,60*e/120,40*e/120,20*e/120),ctx.beginPath(),ctx.lineTo(0,80*e/120),ctx.lineTo(20*e/120,40*e/120),ctx.lineTo(40*e/120,80*e/120),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(40*e/120,60*e/120),ctx.lineTo(60*e/120,20*e/120),ctx.lineTo(80*e/120,60*e/120),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(80*e/120,80*e/120),ctx.lineTo(100*e/120,40*e/120),ctx.lineTo(120*e/120,80*e/120),ctx.fill(),ctx.closePath()},e=>{ctx.fillStyle="#d63131",ctx.fillRect(40*e/120,0,40*e/120,20*e/120),ctx.fillRect(40*e/120,100*e/120,40*e/120,20*e/120),ctx.beginPath(),ctx.lineTo(0,120*e/120),ctx.lineTo(20*e/120,80*e/120),ctx.lineTo(40*e/120,120*e/120),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(40*e/120,100*e/120),ctx.lineTo(60*e/120,60*e/120),ctx.lineTo(80*e/120,100*e/120),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(80*e/120,120*e/120),ctx.lineTo(100*e/120,80*e/120),ctx.lineTo(120*e/120,120*e/120),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(0,0),ctx.lineTo(20*e/120,40*e/120),ctx.lineTo(40*e/120,0),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(40*e/120,20*e/120),ctx.lineTo(60*e/120,60*e/120),ctx.lineTo(80*e/120,20*e/120),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(80*e/120,0),ctx.lineTo(100*e/120,40*e/120),ctx.lineTo(120*e/120,0),ctx.fill(),ctx.closePath()},e=>{ctx.fillStyle="#8c4141",ctx.beginPath(),ctx.lineTo(0,0),ctx.lineTo(40*e/120,0),ctx.lineTo(0,40*e/120),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(40*e/120,0),ctx.lineTo(60*e/120,20*e/120),ctx.lineTo(80*e/120,0),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(120*e/120,0),ctx.lineTo(80*e/120,0),ctx.lineTo(120*e/120,40*e/120),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(120*e/120,40*e/120),ctx.lineTo(100*e/120,60*e/120),ctx.lineTo(120*e/120,80*e/120),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(120*e/120,120*e/120),ctx.lineTo(80*e/120,120*e/120),ctx.lineTo(120*e/120,80*e/120),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(40*e/120,120*e/120),ctx.lineTo(60*e/120,100*e/120),ctx.lineTo(80*e/120,120*e/120),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(0,120*e/120),ctx.lineTo(40*e/120,120*e/120),ctx.lineTo(0,80*e/120),ctx.fill(),ctx.closePath(),ctx.beginPath(),ctx.lineTo(0,80*e/120),ctx.lineTo(20*e/120,60*e/120),ctx.lineTo(0,40*e/120),ctx.fill(),ctx.closePath()}],qe=shared.obstacles=[];shared.spawnPosition={x:100,y:1500},shared.createPlayer=()=>{Te(0,[],[],{x:shared.spawnPosition.x,y:shared.spawnPosition.y,r:49.5});const e=qe.pop();return e.axisSpeedMultX=e.axisSpeedMultY=1,e.touchingNormalIndexes=[],e.lastTouchingNormalIndexes=[],e.renderRadius=e.lastAliveRadius=e.sat.r,e.xv=e.yv=e.xa=e.ya=0,e.speed=e.baseSpeed=7.167,e.dead=!1,e.onSafe=!1,e.touchingWall=!1,e.stopForces=!1,e.forces=[],e.id=void 0,e.dev=!0,e.god=!1,e.friction=.4,e.ship=!1,e.shipAngle=0,e.shipTurnSpeed=Math.PI/100,e.deathTime=0,e.deathTimer=!1,e.grappleX=-1,e.grappleY=-1,e.grapple=!1,e.grappleRange=488,e.grappleForce=.01,e.grappleFric=.414,e.timeTrapOverrideSafe=!1,e},shared.players=[],!0!==shared.isExClient&&(shared.players.push(shared.createPlayer()),shared.selfId=0,shared.mapDimensions="server"===Se?{x:2e3,y:2e3}:{x:900,y:1600}),!0!==shared.isExClient&&"server"!==Se||(shared.mapDimensions={x:2e3,y:2e3});const Ke=function(){const e=shared.players[shared.selfId];if(!0===shared.isExClient?e.renderRadius=function(e,t,n){return(1-n)*e+n*t}(e.renderRadius,e.sat.r,1/5.4):e.renderRadius=.83*e.renderRadius+.17*e.sat.r,!0===shared.isExClient&&!1===e.dead?(e.xa=(input.right-input.left)*e.speed,e.ya=(input.down-input.up)*e.speed,!0===input.shift&&(!0===e.god?(e.xa*=5,e.ya*=5):(e.xa*=.5,e.ya*=.5)),!1===e.ship?(e.xv+=e.xa*e.axisSpeedMultX,e.yv+=e.ya*e.axisSpeedMultY):(e.shipAngle+=e.xa*e.shipTurnSpeed,e.xv-=Math.cos(e.shipAngle)*e.ya*e.axisSpeedMultX,e.yv-=Math.sin(e.shipAngle)*e.ya*e.axisSpeedMultY),e.pos.x+=e.xv,e.pos.y+=e.yv,e.xv*=e.friction,e.yv*=e.friction):!0===shared.dragging&&!1===e.dead?(Pe=0===e.axisSpeedMultX||0===e.axisSpeedMultY?Math.atan2(shared.mouseY-e.pos.y,shared.mouseX-e.pos.x):Math.atan2((shared.mouseY-e.pos.y)*e.axisSpeedMultX,(shared.mouseX-e.pos.x)*e.axisSpeedMultY),e.xv=Math.cos(Pe)*e.speed*e.axisSpeedMultX,e.yv=Math.sin(Pe)*e.speed*e.axisSpeedMultY,Math.abs(e.xv)>Math.abs(e.pos.x-shared.mouseX)&&(e.xv=shared.mouseX-e.pos.x),Math.abs(e.yv)>Math.abs(e.pos.y-shared.mouseY)&&(e.yv=shared.mouseY-e.pos.y),e.pos.x+=e.xv,e.pos.y+=e.yv):e.xv=e.yv=0,e.axisSpeedMultX=e.axisSpeedMultY=1,!0===e.stopForces)e.stopForces=!1,e.forces.length=0;else for(let t=0;t<e.forces.length;t+=3)e.pos.x+=e.forces[t],e.pos.y+=e.forces[t+1],e.forces[t]*=e.forces[t+2],e.forces[t+1]*=e.forces[t+2],Math.abs(e.forces[t])<.01&&Math.abs(e.forces[t+1])<.01&&(e.forces.splice(t,3),t-=3);if(!0===e.dead){e.forces.length=0,e.renderRadius=e.lastAliveRadius;for(let t=0;t<qe.length;t++)for(let n=0;n<qe[t].simulate.length;n++)qe[t].simulate[n](qe[t],e)}else{if(e.lastAliveRadius=e.sat.r,!0!==e.god){e.pos.x-e.sat.r<0?e.pos.x=e.sat.r:e.pos.x+e.sat.r>shared.mapDimensions.x&&(e.pos.x=shared.mapDimensions.x-e.sat.r),e.pos.y-e.sat.r<0?e.pos.y=e.sat.r:e.pos.y+e.sat.r>shared.mapDimensions.y&&(e.pos.y=shared.mapDimensions.y-e.sat.r);for(let t=0;t<qe.length;t++){if(ke=void 0!==qe[t].sat.r?void 0!==qe[t].startSlice?Fe(qe[t],e,Ie):Ae.testCircleCircle(qe[t].sat,e.sat,Ie):Ae.testPolygonCircle(qe[t].sat,e.sat,Ie),!0===ke)for(let n=0;n<qe[t].effect.length;n++)qe[t].effect[n](e,Ie,qe[t],t);Ie.clear();for(let n=0;n<qe[t].simulate.length;n++)qe[t].simulate[n](qe[t],e)}}else for(let t=0;t<qe.length;t++)for(let n=0;n<qe[t].simulate.length;n++)qe[t].simulate[n](qe[t],e);if(!0===e.grapple)if(!0===input.action1&&-1===e.grappleX){let t=e.sat.r;e.sat.r=e.grappleRange;let n=0,o=0,i=!1;for(let t=0;t<qe.length;t++)!0===qe[t].isGrapplePoint&&!1===i&&(o=e.sat.r,e.sat.r=e.grappleRange),ke=void 0!==qe[t].sat.r?void 0!==qe[t].startSlice?Fe(qe[t],e,Ie):Ae.testCircleCircle(qe[t].sat,e.sat,Ie):Ae.testPolygonCircle(qe[t].sat,e.sat,Ie),!0===qe[t].isGrapplePoint?!0===ke?(i=!0,e.sat.r-=Ie.overlap,n=Math.atan2(Ie.overlapN.y,Ie.overlapN.x)):!1===i&&(e.sat.r=o):!0===ke&&!1===i&&(e.sat.r-=Ie.overlap,n=Math.atan2(Ie.overlapN.y,Ie.overlapN.x)),Ie.clear();e.sat.r<e.grappleRange&&(e.sat.r=Math.max(e.sat.r,0),e.grappleX=e.pos.x-Math.cos(n)*e.sat.r,e.grappleY=e.pos.y-Math.sin(n)*e.sat.r),e.sat.r=t}else if(-1!==e.grappleX)if(!1===input.action1)e.grappleX=e.grappleY=-1;else{let t=Math.sqrt((e.pos.x-e.grappleX)**2+(e.pos.y-e.grappleY)**2),n=Math.atan2(e.grappleY-e.pos.y,e.grappleX-e.pos.x);e.forces.push(Math.cos(n)*t*e.grappleForce,Math.sin(n)*t*e.grappleForce,e.grappleFric)}}if(0===e.touchingNormalIndexes.length&&0===e.lastTouchingNormalIndexes.length||(e.lastTouchingNormalIndexes=e.touchingNormalIndexes,e.touchingNormalIndexes=[]),!0===e.onSafe&&(e.onSafe=!1,!0===e.timeTrapOverrideSafe?e.timeTrapOverrideSafe=!1:e.dead=!1),!0===e.deathTimer&&(e.deathTime--,(e.deathTime<0||!0===e.dead)&&(e.deathTime=1/0,e.deathTimer=!1,e.dead=!0,shared.u4[0]=14,send(shared.u4))),e.touchingWall=!1,e.sat.r>900&&(e.sat.r=900),!0!==e.god?(e.pos.x-e.sat.r<0?(e.pos.x=e.sat.r,e.touchingWall=!0):e.pos.x+e.sat.r>mapDimensions.x&&(e.pos.x=mapDimensions.x-e.sat.r,e.touchingWall=!0),e.pos.y-e.sat.r<0?(e.pos.y=e.sat.r,e.touchingWall=!0):e.pos.y+e.sat.r>mapDimensions.y&&(e.pos.y=mapDimensions.y-e.sat.r,e.touchingWall=!0)):e.dead=!1,shared.tickFns.length>0){for(let e=0;e<shared.tickFns.length;e++)shared.tickFns[e]();shared.tickFns.length=0}!0===Me&&(Me=!1,!0===shared.dragging&&shared.onmouseup(),ye()),window.frames++};shared.mouse={screen:{x:-1,y:-1},world:{x:-1,y:-1}},shared.mouseX=-1,shared.mouseY=-1,shared.scrollLocked=!1,shared.mouseDownFunctions=[],shared.mouseMoveFunctions=[],shared.mouseUpFunctions=[],shared.mouseOut=!1,shared.pageX=-1,shared.pageY=-1,shared.dragging=!1,shared.onmousedown=e=>{},shared.onmousemove=e=>{},shared.onmouseup=()=>{},shared.oncontextmenu=e=>e.preventDefault();const He={KeyW:"up",KeyS:"down",KeyA:"left",KeyD:"right",ArrowUp:"up",ArrowDown:"down",ArrowLeft:"left",ArrowRight:"right",ShiftLeft:"shift",ShiftRight:"shift",KeyC:"action1",KeyJ:"action1",KeyY:"action1"};shared.input={up:!1,down:!1,left:!1,right:!1,shift:!1,action1:!1};let Ze=!1,Qe=!1;shared.onkeydown=it,shared.onkeyup=it;const{encodeAtPosition:et}=K,tt=document.querySelector(".chat"),nt=document.querySelector(".chatDiv"),ot=document.querySelector(".chat-div");function it(e){if(!0===Ze){if("keydown"===e.type&&"Enter"===e.code){let e=tt.value.trim();if("/reset"===e)shared.changeMap("/maps/hub");else if("/tpmap"===e.slice(0,6))shared.changeMap("/maps/"+e.slice(7).toLowerCase());else if("/scale"===e.slice(0,6)){const t=parseFloat(e.slice(7));changeCameraScale(t)}else if("/map"===e.slice(0,4))shared.initImportMap(e.slice(5));else if(void 0!==shared.zones&&"/tpzone"===e.slice(0,7).toLowerCase()){const t=parseInt(e.slice(8));for(let e=0;e<shared.zones.length;e++)if(shared.zones[e].zone===t){shared.players[shared.selfId].pos.x=shared.zones[e].x,shared.players[shared.selfId].pos.y=shared.zones[e].y;break}}else if(0!==e.length){e=shared.username+": "+e;const t=new Uint8Array(e.length+2);t[0]=7,!0===shared.players[shared.selfId].dev?t[1]=2:!0===shared.players[shared.selfId].guest&&(t[1]=3),et(e,t,2),send(t)}tt.value="",tt.blur(),nt.classList.add("hidden"),Ze=!1}}else{if(e.repeat)return e.preventDefault();if("keydown"===e.type){if("KeyO"===e.code&&!0===shared.players[shared.selfId].dev){shared.players[shared.selfId].god=!shared.players[shared.selfId].god;const t=new Uint8Array(2);return t[0]=8,t[1]=shared.players[shared.selfId].god,send(t),e.preventDefault()}"KeyR"===e.code&&!0===shared.players[shared.selfId].dead?shared.respawnPlayer():"Enter"===e.code?(Ze=!0,nt.classList.remove("hidden"),tt.focus()):"KeyZ"===e.code?(Qe?ot.classList.contains("hidden")&&(ot.classList.remove("hidden"),ot.scrollTop=ot.scrollHeight):(tt.blur(),ot.classList.contains("hidden")||ot.classList.add("hidden")),Qe=!Qe):"KeyU"===e.code&&(shared.renderDebug=!shared.renderDebug)}null!=He[e.code]&&(shared.input[He[e.code]]="keydown"===e.type,e.preventDefault())}}let rt;shared.initImportMap=async e=>{void 0===rt&&(rt=(await a.e(78).then(a.bind(a,78))).default),rt(e)};const{until:at}=K;let st,lt;shared.hasLoadedNewMusic=!1;let ct=0;shared.stopMusic=async(e=!1)=>{if(!0===e){let e=!1,t=Date.now();if(await at((()=>void 0!==lt&&(ct>t&&(e=!0),!0))),!0===e)return}else if(void 0===lt)return;lt.remove(),lt=void 0,st=void 0},shared.playMusic=async(e,t=0)=>{if(shared.hasLoadedNewMusic=!0,await at((()=>!0===navigator.userActivation.hasBeenActive)),e===st)return;stopMusic(),st=e,lt=document.createElement("iframe"),lt.frameborder="0",lt.setAttribute("frameBorder","0"),lt.width=0,lt.height=0;const n=e.split("?v=")[1];lt.src=`https://www.youtube.com/embed/${n}?autoplay=1&loop=1&playlist=${n}&enablejsapi=1${0===t?"":"&start="+t}`,lt.allow="autoplay",lt.security="restricted",lt.style.position="fixed",lt.classList.add("yt"),lt.id=n,document.body.appendChild(lt),ct=Date.now()},shared.playMusicIndefinitely=async e=>{st=void 0,await shared.playMusic(e),lt=void 0},shared.reloadMusic=()=>{let e=st;st=void 0,shared.playMusic(e)},a(681),shared.isExClient=!0;const dt=shared.gui=document.querySelector(".gui");let pt,ut,ht;shared.mapPath="",shared.username="",shared.authId=-1,shared.startGame=()=>{dt.classList.remove("hidden"),pt=performance.now(),shared.respawnPlayer(),ft(),console.log("game starting")},pt=ut=ht=0,window.frames=0;const wt=1e3/60;function ft(){for(requestAnimationFrame(ft),ht=performance.now(),ut+=ht-pt,pt=ht,ut>2e3&&(ut=0);ut>=0;)ut-=wt,Ke();!function(){const e=shared.players[shared.selfId];mt[1]=e.pos.x,mt[2]=e.pos.y,send(gt),!0===e.grapple&&(gt[0]=11,mt[1]=e.grappleX,mt[2]=e.grappleY,send(gt),gt[0]=4),!0===e.ship&&St!==e.shipAngle&&(St=e.shipAngle,xt[0]=9,yt[1]=e.shipAngle,send(xt)),!0===e.deathTimer&&(xt[0]=13,yt[1]=e.deathTime,send(xt)),e.dead!==vt&&(vt=e.dead,shared.u4[0]=15,shared.u4[1]=!0===e.dead?1:0,send(shared.u4))}(),shared.render()}const gt=new Uint8Array(12);gt[0]=4;const mt=new Float32Array(gt.buffer),xt=new Uint8Array(8),yt=new Float32Array(xt.buffer);shared.u4=new Uint8Array(4);let St=1/0,vt=!1})()})();